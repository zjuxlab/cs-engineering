"use strict";(self.webpackChunkcs_engineering=self.webpackChunkcs_engineering||[]).push([[8869],{5680:(e,n,t)=>{t.d(n,{xA:()=>p,yg:()=>y});var a=t(6540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),u=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=u(e.components);return a.createElement(l.Provider,{value:n},e.children)},g="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),g=u(t),m=r,y=g["".concat(l,".").concat(m)]||g[m]||c[m]||o;return t?a.createElement(y,i(i({ref:n},p),{},{components:t})):a.createElement(y,i({ref:n},p))}));function y(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[g]="string"==typeof e?e:r,i[1]=s;for(var u=2;u<o;u++)i[u]=t[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},9671:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var a=t(8168),r=(t(6540),t(5680));const o={title:"Vue Pinia",slug:"ruan-jian-gong-cheng-ji-neng-shu/qian-duan-ji-shu/kuang-jia-ru-men/vue/gong-neng-kuang-jia/vuepinia/vuepinia",sidebar_position:3},i="Vue Pinia",s={unversionedId:"\u8f6f\u4ef6\u5de5\u7a0b\u6280\u80fd\u6811/\u524d\u7aef\u6280\u672f/\u6846\u67b6\u5165\u95e8/Vue/\u529f\u80fd\u6846\u67b6/VuePinia/VuePinia",id:"\u8f6f\u4ef6\u5de5\u7a0b\u6280\u80fd\u6811/\u524d\u7aef\u6280\u672f/\u6846\u67b6\u5165\u95e8/Vue/\u529f\u80fd\u6846\u67b6/VuePinia/VuePinia",title:"Vue Pinia",description:"Author\uff1aNA",source:"@site/docs/\u8f6f\u4ef6\u5de5\u7a0b\u6280\u80fd\u6811/\u524d\u7aef\u6280\u672f/\u6846\u67b6\u5165\u95e8/Vue/\u529f\u80fd\u6846\u67b6/VuePinia/VuePinia.md",sourceDirName:"\u8f6f\u4ef6\u5de5\u7a0b\u6280\u80fd\u6811/\u524d\u7aef\u6280\u672f/\u6846\u67b6\u5165\u95e8/Vue/\u529f\u80fd\u6846\u67b6/VuePinia",slug:"/\u8f6f\u4ef6\u5de5\u7a0b\u6280\u80fd\u6811/\u524d\u7aef\u6280\u672f/\u6846\u67b6\u5165\u95e8/Vue/\u529f\u80fd\u6846\u67b6/VuePinia/ruan-jian-gong-cheng-ji-neng-shu/qian-duan-ji-shu/kuang-jia-ru-men/vue/gong-neng-kuang-jia/vuepinia/vuepinia",permalink:"/cs-engineering/docs/\u8f6f\u4ef6\u5de5\u7a0b\u6280\u80fd\u6811/\u524d\u7aef\u6280\u672f/\u6846\u67b6\u5165\u95e8/Vue/\u529f\u80fd\u6846\u67b6/VuePinia/ruan-jian-gong-cheng-ji-neng-shu/qian-duan-ji-shu/kuang-jia-ru-men/vue/gong-neng-kuang-jia/vuepinia/vuepinia",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u8f6f\u4ef6\u5de5\u7a0b\u6280\u80fd\u6811/\u524d\u7aef\u6280\u672f/\u6846\u67b6\u5165\u95e8/Vue/\u529f\u80fd\u6846\u67b6/VuePinia/VuePinia.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Vue Pinia",slug:"ruan-jian-gong-cheng-ji-neng-shu/qian-duan-ji-shu/kuang-jia-ru-men/vue/gong-neng-kuang-jia/vuepinia/vuepinia",sidebar_position:3},sidebar:"sidebar",previous:{title:"Vite",permalink:"/cs-engineering/docs/\u8f6f\u4ef6\u5de5\u7a0b\u6280\u80fd\u6811/\u524d\u7aef\u6280\u672f/\u6846\u67b6\u5165\u95e8/Vue/\u529f\u80fd\u6846\u67b6/Vite/ruan-jian-gong-cheng-ji-neng-shu/qian-duan-ji-shu/kuang-jia-ru-men/vue/gong-neng-kuang-jia/vite/vite"},next:{title:"NuxtJS",permalink:"/cs-engineering/docs/\u8f6f\u4ef6\u5de5\u7a0b\u6280\u80fd\u6811/\u524d\u7aef\u6280\u672f/\u6846\u67b6\u5165\u95e8/Vue/\u529f\u80fd\u6846\u67b6/NuxtJS/ruan-jian-gong-cheng-ji-neng-shu/qian-duan-ji-shu/kuang-jia-ru-men/vue/gong-neng-kuang-jia/nuxtjs/nuxtjs"}},l={},u=[{value:"<b>\u5565\u662fpinia</b>",id:"\u5565\u662fpinia",level:4},{value:"<b>\u5feb\u901f\u4e0a\u624b</b>",id:"\u5feb\u901f\u4e0a\u624b",level:4},{value:"<b>\u5b89\u88c5</b>",id:"\u5b89\u88c5",level:5},{value:"<b>\u521b\u5efa\u4ed3\u5e93</b>",id:"\u521b\u5efa\u4ed3\u5e93",level:5},{value:"<b>\u4f7f\u7528\u4ed3\u5e93</b>",id:"\u4f7f\u7528\u4ed3\u5e93",level:5},{value:"<b>State</b>",id:"state",level:5},{value:"<b>Getter</b>",id:"getter",level:5},{value:"<b>Actions</b>",id:"actions",level:5},{value:"<b>\u4f7f\u7528\u63d2\u4ef6</b>",id:"\u4f7f\u7528\u63d2\u4ef6",level:5},{value:"<b>\u5728\u7ec4\u4ef6\u4e4b\u5916\u4f7f\u7528pinia</b>",id:"\u5728\u7ec4\u4ef6\u4e4b\u5916\u4f7f\u7528pinia",level:5},{value:"<b>SSR</b>",id:"ssr",level:4},{value:"<b>Vue&amp;Vite</b>",id:"vuevite",level:5},{value:"<b>\u5c0f\u7ed3</b>",id:"\u5c0f\u7ed3",level:4},{value:"<b>\u6587\u6863\u548c\u5f15\u7528</b>",id:"\u6587\u6863\u548c\u5f15\u7528",level:4}],p={toc:u},g="wrapper";function c(e){let{components:n,...t}=e;return(0,r.yg)(g,(0,a.A)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"vue-pinia"},"Vue Pinia"),(0,r.yg)("p",null,"Author\uff1aNA"),(0,r.yg)("h4",{id:"\u5565\u662fpinia"},(0,r.yg)("b",null,"\u5565\u662fpinia")),(0,r.yg)("img",{src:"/assets/DIbFb26bqouHWTxcK0Pc47WEnhf.png","src-width":"474","src-height":"491",align:"center"}),(0,r.yg)("p",null,"pinia\u5c31\u662f\u8fd9\u4e2a\u5f88\u53ef\u7231\u7684\u83e0\u841d\uff08x\uff0cpinia\u662f\u4e00\u4e2a\u7528\u4e8evue\u7684\u72b6\u6001\u7ba1\u7406\uff08state management\uff09\u7684\u89e3\u51b3\u65b9\u6848\u3002\u5728vue\u4e2d\uff0c\u7ec4\u4ef6\u4e4b\u95f4\u4f20\u8f93\u4fe1\u606f\u9075\u4ece\u4e0b\u7ea7\u5230\u4e0a\u7ea7\u4f7f\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"emit"),"\u4e0a\u7ea7\u5230\u4e0b\u7ea7\u4f7f\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"props"),"\u8fd9\u6837\u7684\u7684\u5e38\u89c4\uff0c\u5f53\u7ec4\u4ef6\u8d8a\u6765\u8d8a\u591a\u7684\u65f6\u5019\uff0c\u8fd9\u79cd\u4f20\u8f93\u7684\u7ed3\u6784\u5c31\u4f1a\u8d8a\u6765\u8d8a\u590d\u6742\uff0c\u5982\u4e0b\uff0c\u540c\u65f6\u4f60\u8fd8\u9700\u8981\u989d\u5916\u8003\u8651\u6bcf\u4e00\u4e2a\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u7a76\u7adf\u5982\u4f55\u7ec4\u7ec7\u5bf9\u8c61\uff0c\u4f7f\u5f97\u6700\u540e\u7684\u7ed3\u679c\u517c\u987e\u6548\u7387\u4e0e\u7075\u6d3b\u6027\u3002"),(0,r.yg)("img",{src:"/assets/HOhgbQaYpoWAHGxMQxvcT66bnBe.png","src-width":"793","src-height":"1024",align:"center"}),(0,r.yg)("p",null,"\u603b\u4e4b\uff0c\u5f53\u7ec4\u4ef6\u7684\u6570\u91cf\u8fbe\u5230\u4e34\u754c\uff0c\u8bbe\u8ba1\u8fd9\u6837\u7684\u590d\u6742\u4f20\u8f93\u4f1a\u53d8\u5f97\u975e\u5e38\u6298\u78e8\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u4e00\u79cd\u7c7b\u4f3c\u4e8e",(0,r.yg)("b",null,"\u5168\u5c40\u72b6\u6001"),"\u7684\u4e1c\u897f\u6765\u7b80\u5316\u5c40\u9762\uff0c\u91cd\u65b0\u7ec4\u7ec7\u4fe1\u606f\u7684\u4f20\u9012\u3002"),(0,r.yg)("img",{src:"/assets/Y93AblyQCoy74xxNFupcXSM1n3g.png","src-width":"1503","src-height":"989",align:"center"}),(0,r.yg)("p",null,"\u8fd9\u65f6\u5019\u5c31\u4e0d\u5f97\u4e0d\u63d0",(0,r.yg)("inlineCode",{parentName:"p"},"vuex"),"\u4e86\uff0c\u8fd9\u79cd\u5efa\u7acb\u5168\u5c40\u72b6\u6001\u7684\u5de5\u4f5c\u4ec0\u4e48\u7684\uff0c\u597d\u50cf",(0,r.yg)("inlineCode",{parentName:"p"},"vuex"),"\u5df2\u7ecf\u5b8c\u6210\u4e86\u5440\uff0c\u8fd9\u8bdd\u6ca1\u9519\uff0c\u4f7f\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"vuex")," \u548c",(0,r.yg)("inlineCode",{parentName:"p"},"pinia"),"\u90fd\u53ef\u4ee5\u89e3\u51b3\u72b6\u6001\u7ba1\u7406\u95ee\u9898\uff0c\u4e0d\u8fc7pinia\u66f4\u65b0\uff0c\u800c\u4e14\u62e5\u6709\u7279\u522b\u7684\u4f18\u52bf\uff0c\u5177\u4f53\u6765\u8bb2\u662f\uff1a"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"\u66f4\u52a0\u7b80\u5355\u548c\u76f4\u89c9\u5316\uff0c\u5199store\u548c\u5199\u7ec4\u4ef6\uff08component\uff0c\u4e0b\u9762\u901a\u7528\uff09\u4e00\u6837\uff0c\u6709\u4e00\u7cfb\u5217API\u6765\u5e2e\u4f60\u5199\u51fa\u7ec4\u7ec7\u826f\u597d\u7684\u4ed3\u5e93\uff08store\uff0c\u4e0b\u9762\u901a\u7528\uff09"),(0,r.yg)("li",{parentName:"ul"},"\u7c7b\u578b\u5b89\u5168\uff0c\u6709\u7c7b\u578b\u63a8\u65ad\uff0c\u81ea\u52a8\u8865\u5168\uff0cjs\u4e5f\u53ef\u4ee5\u8865\u5168"),(0,r.yg)("li",{parentName:"ul"},"\u66f4\u597d\u7684\u8c03\u8bd5\u5de5\u5177\u652f\u6301\uff0cpinia\u548c\u8c03\u8bd5\u5de5\u5177\u7ed3\u5408\u7684\u66f4\u597d\uff08vue 2\uff0cvue 3\uff09\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u7528\u8c03\u8bd5\u5de5\u5177\u4fee\u6539\u72b6\u6001"),(0,r.yg)("li",{parentName:"ul"},"\u53ef\u6269\u5c55\u6027\u597d\uff0c\u4f8b\u5982\u4f7f\u7528\u63d2\u4ef6\u83b7\u53d6 transaction \u548c local storage synchronization\u7684\u529f\u80fd"),(0,r.yg)("li",{parentName:"ul"},"\u6a21\u5757\u5316\uff0c\u4ece\u8bbe\u8ba1\u4e0apinia\u5c31\u505a\u6210\u4e86\u6a21\u5757\u5316\u7684\uff0c\u4f60\u53ef\u4ee5\u5efa\u591a\u4e2a\u4ed3\u5e93\uff0c\u81ea\u52a8\u5730code split\uff0c\u7b49\u7b49"),(0,r.yg)("li",{parentName:"ul"},"\u5de8\u8f7b\uff0c\u5927\u5c0f\u4e0a\u7ea61 kb\uff0c\u4f7f\u7528\uff08performance\uff09\u7684\u65f6\u5019\u51e0\u4e4e\u4e0d\u7528\u8003\u8651\u5f71\u54cd")),(0,r.yg)("p",null,"\u540e\u9762\u8fd8\u5c06\u4ed4\u7ec6\u4ecb\u7ecd\u4e00\u4e9bpinia\u7684\u7279\u70b9\uff0cpinia\u7684\u4f18\u52bf\u4e5f\u4e0d\u6b62\u8fd9\u4e9b\uff0c\u603b\u4e4b\u8fb9\u770b\u8fb9\u4ecb\u7ecd\u5427\u3002"),(0,r.yg)("h4",{id:"\u5feb\u901f\u4e0a\u624b"},(0,r.yg)("b",null,"\u5feb\u901f\u4e0a\u624b")),(0,r.yg)("h5",{id:"\u5b89\u88c5"},(0,r.yg)("b",null,"\u5b89\u88c5")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"yarn add pinia\n # or with npm\n npm install pinia\n")),(0,r.yg)("p",null,"\u521b\u5efapinia\u5b9e\u4f8b\uff08\u6839\u4ed3\u5e93\uff09\uff0c\u7136\u540e\u4ee5\u63d2\u4ef6\u7684\u5f62\u5f0f\u4f20\u7ed9app"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { createApp } from 'vue'\n import { createPinia } from 'pinia'\n import App from './App.vue'\n \n const pinia = createPinia()\n const app = createApp(App)\n \n app.use(pinia)\n app.mount('#app')\n")),(0,r.yg)("h5",{id:"\u521b\u5efa\u4ed3\u5e93"},(0,r.yg)("b",null,"\u521b\u5efa\u4ed3\u5e93")),(0,r.yg)("p",null,"\u901a\u8fc7pinia\u63d0\u4f9b\u7684\u4e00\u4e2a\u51fd\u6570\u4ee5\u53ca\u4f60\u7ed9\u4ed3\u5e93\u8d77\u7684\u540d\u5b57\uff08id\uff0c\u4e0d\u91cd\u590d\uff09\u521b\u5efa\u4ed3\u5e93\uff0c"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { defineStore } from 'pinia'\n \n export const useAlertsStore = defineStore('alerts', {\n   // other options...\n })\n")),(0,r.yg)("p",null,"\u6ce8\u610f\uff0c\u8fd4\u56de\u7684\u51fd\u6570\u662f\u7528\u6765\u5728\u5176\u4ed6\u5730\u65b9\u4f7f\u7528\u8be5\u4ed3\u5e93\u7684\uff0c\u6240\u4ee5\u547d\u540d\u7684\u65f6\u5019\u4e00\u822c\u662f",(0,r.yg)("inlineCode",{parentName:"p"},"use + name + store"),"\u8fd9\u6837\u3002"),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"defienStore()"),"\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4ed3\u5e93\u540d\u5b57\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u548c\u4ed3\u5e93\u7684\u5177\u4f53\u7ed3\u6784\u6709\u5173\uff0c\u540c\u65f6\u8fd8\u6709\u4e24\u79cd\u9009\u62e9"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"option store"),(0,r.yg)("li",{parentName:"ul"},"setup store")),(0,r.yg)("p",null,"\u7b2c\u4e00\u79cd\u5927\u81f4\u9075\u5faa\u8fd9\u6837\u7684\u683c\u5f0f\uff0c\u548cvue\u7684option\u98ce\u683c\u4e00\u81f4\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"// option store\n export const useCounterStore = defineStore('counter', {\n   state: () => ({ count: 0, name: 'Eduardo' }),\n   getters: {\n     doubleCount: (state) => state.count * 2,\n   },\n   actions: {\n     increment() {\n       this.count++\n     },\n   },\n })\n")),(0,r.yg)("p",null,"\u53ef\u4ee5\u770b\u5230\u5177\u4f53\u5b9a\u4e49\u91cc\u6709",(0,r.yg)("inlineCode",{parentName:"p"},"state,getter,actions"),"\uff0c\u53ef\u4ee5\u5206\u522b\u628a\u4ed6\u4eec\u5bf9\u5e94\u5230vue\u7684",(0,r.yg)("inlineCode",{parentName:"p"},"data,computed,methods")),(0,r.yg)("p",null,"\u7b2c\u4e8c\u79cd\u5219\u548cVue Composition API \u7684\u98ce\u683c\u63a5\u8fd1\u4e00\u4e9b\uff0c\u6211\u4eec\u4f20\u5165\u4e00\u4e2a\u5b9a\u4e49\u4e86\u4ed3\u5e93\u91cc\u7684\u54cd\u5e94\u5f0f\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u7684\u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u4e86\u6211\u4eec\u5e0c\u671b\u66b4\u9732\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u7684\u5bf9\u8c61\u3002"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"// setup store\n export const useCounterStore = defineStore('counter', () => {\n   const count = ref(0)\n   const name = ref('Eduardo')\n   const doubleCount = computed(() => count.value * 2)\n   function increment() {\n     count.value++\n   }\n \n   return { count, name, doubleCount, increment }\n })\n")),(0,r.yg)("p",null,"\u5728 Setup Stores\u4e2d:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"ref()"),"s become ",(0,r.yg)("inlineCode",{parentName:"li"},"state")," properties"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"computed()"),"s become ",(0,r.yg)("inlineCode",{parentName:"li"},"getters")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"function()"),"s become ",(0,r.yg)("inlineCode",{parentName:"li"},"actions"))),(0,r.yg)("p",null,"\u53ef\u4ee5\u770b\u5230 setup store \u6bd4 option store \u7075\u6d3b\u5f88\u591a\uff0c\u6bd4\u65b9\u8bf4\u5728\u4ed3\u5e93\u91cc\u653ewatcher\uff0c\u6216\u8005\u585e\u6240\u8c13\u7684 composable\uff08vue.js \u7684\u6982\u5ff5)\u3002\u5f53\u7136\uff0c\u8fd9\u4e9b\u4f1a\u5728SSR\uff08server-side rendering\uff09\u7684\u573a\u666f\u4e0b\u53d8\u5f97\u66f4\u52a0\u590d\u6742\u3002"),(0,r.yg)("p",null,"\u4e24\u79cd\u65b9\u6cd5\u9009\u54ea\u4e2a\uff1f\u5b98\u65b9\u6587\u6863\u7684\u5efa\u8bae\u662f\u7528\u4f60\u987a\u624b\u7684\uff08x\uff0c"),(0,r.yg)("em",null,"\u4e0d\u786e\u5b9a\u7684\u8bdd\uff0c\u5efa\u8bae\u5148\u7528 Option Store"),(0,r.yg)("h5",{id:"\u4f7f\u7528\u4ed3\u5e93"},(0,r.yg)("b",null,"\u4f7f\u7528\u4ed3\u5e93")),(0,r.yg)("p",null,"\u4ed3\u5e93\u5728 ",(0,r.yg)("inlineCode",{parentName:"p"},"setup()")," \u51fd\u6570\u4e2d\u521b\u5efa\uff0c\u5177\u4f53\u5b9e\u4f8b\u5219\u901a\u8fc7\u4e4b\u524d\u5b9a\u4e49\u597d\u7684",(0,r.yg)("inlineCode",{parentName:"p"},"usexxxStore()"),"\u6765\u751f\u6210\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { useCounterStore } from '@/stores/counter'\n \n export default {\n   setup() {\n     const store = useCounterStore()\n \n     return {\n       // you can return the whole store instance to use it in the template\n       store,\n     }\n   },\n }\n")),(0,r.yg)("p",null,"\u8fd9\u6837\u76f8\u4f3c\u7684\u4ed3\u5e93\u53ef\u4ee5\u521b\u5efa\u5f88\u591a\u4e2a\uff0c\u6bd4\u5982AAA\uff0cBBB\uff0c\u4f60\u53ea\u9700\u8981\u5728",(0,r.yg)("b",null,"\u4e0d\u540c\u7684"),"\u6587\u4ef6\u91cc\u7ed9\u51fa\u5b9a\u4e49\uff0c\u8fd9\u6837\u53ef\u4ee5\u6700\u5927\u5316pinia\u7684\u4f18\u52bf(like automatically allowing your bundler to code split and providing TypeScript inference)\u3002"),(0,r.yg)("p",null,"\u521b\u5efa\u5b8c\u4ed3\u5e93\u4e4b\u540e\u4f60\u5c31\u53ef\u4ee5\u81ea\u7531\u8bbf\u95ee\u5176\u4e2d\u7684 state\uff0cgetter\u6216\u8005\u662faction\u4e86\uff0c\u5177\u4f53\u4ecb\u7ecd \u653e\u5728\u4e0b\u8282\uff0c\u5728\u6b64\u4e4b\u524d\uff0c\u6392\u9664\u4e00\u4e2a\u9519\u8bef\u505a\u6cd5\u3002"),(0,r.yg)("p",null,"\u6ce8\u610f\u5230\u4ed3\u5e93\u662f\u4e00\u4e2areactive\u7684\u5bf9\u8c61\uff0c\u6240\u4ee5\u4f60\u4e0d\u5fc5\u5728getter\u540e\u9762\u52a0.value\uff0c\u4f46\u662f\uff0c\u5c31\u50cf",(0,r.yg)("inlineCode",{parentName:"p"},"setup")," \u91cc\u7684\u5c5e\u6027\uff0c\u6211\u4eec\u4e5f\u4e0d\u80fd\u62c6\u5206\u5b83\u4eec\u3002\u8fd8\u662f\u770b\u4ee3\u7801\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'export default defineComponent({\n   setup() {\n     const store = useCounterStore()\n     // \u274c This won\'t work because it breaks reactivity\n     // it\'s the same as destructuring from props\n     const { name, doubleCount } = store\n \n     name // "Eduardo"\n     doubleCount // 0\n \n     setTimeout(() => {\n       store.increment()\n     }, 1000)\n \n     return {\n       // will always be "Eduardo"\n       name,\n       // will always be 0\n       doubleCount,\n       // will also always be 0\n       doubleNumber: store.doubleCount,\n \n       // \u2705 this one will be reactive\n       doubleValue: computed(() => store.doubleCount),\n     }\n   },\n })\n')),(0,r.yg)("p",null,"\u8981\u4fdd\u5b58\u8fd9\u79cdreactivity\uff0c\u4f7f\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"storeToRefs()"),"\u51fd\u6570\uff0c\u8fd9\u662f\u4e00\u4e2apinia\u63d0\u4f9b\u7684\u51fd\u6570\uff0c\u5176\u4f5c\u7528\u5982\u4e0b\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { storeToRefs } from 'pinia'\n \n export default defineComponent({\n   setup() {\n     const store = useCounterStore()\n     // name and doubleCount are reactive refs\n     // This will also create refs for properties added by plugins\n     // but skip any action or non reactive (non ref/reactive) property\n     const { name, doubleCount } = storeToRefs(store)\n     // the increment action can just be extracted\n     const { increment } = store\n \n     return {\n       name,\n       doubleCount,\n       increment,\n     }\n   },\n })\n")),(0,r.yg)("em",null,"\u6ce8\u610faction\u4e5f\u53ef\u4ee5\u76f4\u63a5\u62c6\u51fa\u6765"),(0,r.yg)("h5",{id:"state"},(0,r.yg)("b",null,"State")),(0,r.yg)("p",null,"\u4ece\u4f7f\u7528\u89d2\u5ea6\u6765\u8bb2\uff0c\u72b6\u6001\u662f\u4e00\u4e2a\u4ed3\u5e93\u4e2d\u6211\u4eec\u6700\u5173\u5fc3\u7684\u65b9\u9762\uff0c\u5728 Pinia \u4e2d\uff0c\u72b6\u6001\u88ab\u5b9a\u4e49\u4e3a\u8fd4\u56de\u521d\u59cb\u72b6\u6001\u7684\u51fd\u6570\u3002\u8fd9\u5141\u8bb8 Pinia \u5728\u670d\u52a1\u5668\u7aef\u548c\u5ba2\u6237\u7aef\u5de5\u4f5c\u3002\u4e0b\u9762\u662f\u4e00\u4e2aoption store\u7684\u4f8b\u5b50"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { defineStore } from 'pinia'\n \n export const useStore = defineStore('storeId', {\n   // arrow function recommended for full type inference\n   state: () => {\n     return {\n       // all these properties will have their type inferred automatically\n       count: 0,\n       name: 'Eduardo',\n       isAdmin: true,\n       items: [],\n       hasChanged: true,\n     }\n   },\n })\n")),(0,r.yg)("p",null,"Pinia\u7edd\u8d5e\u7684\u4e00\u70b9\u662fTS\u8d85\u597d\u517c\u5bb9\uff0c\u539f\u6587\u6863\u7684\u63cf\u8ff0\u662f\u8fd9\u6837\u7684\uff1a"),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Make sure ",(0,r.yg)("inlineCode",{parentName:"p"},"strict"),", or at the very least, ",(0,r.yg)("inlineCode",{parentName:"p"},"noImplicitThis"),", are enabled and Pinia will infer the type of your state automatically!")),(0,r.yg)("p",null,"\u6240\u4ee5\u53ea\u9700\u8981\u8bb0\u4f4f\u51e0\u4e2a\u9700\u8981\u7c7b\u578b\u63d0\u793a\u7684\u573a\u666f\uff08\u76f8\u5f53\u5408\u7406\u7684\u51e0\u4e2a\uff09\uff0c\u5c31\u4e0d\u9700\u8981\u62c5\u5fc3ts\u95ee\u9898\u4e86,\u5982\u4e0b"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export const useUserStore = defineStore('user', {\n   state: () => {\n     return {\n       // for initially empty lists\n       userList: [] as UserInfo[],\n       // for data that is not yet loaded\n       user: null as UserInfo | null,\n     }\n   },\n })\n \n interface UserInfo {\n   name: string\n   age: number\n }\n")),(0,r.yg)("p",null,"\u6216\u8005\u4e5f\u53ef\u4ee5\u628a\u53e3\u90fd\u660e\u786e\u4e00\u4e0b"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"interface State {\n   userList: UserInfo[]\n   user: UserInfo | null\n }\n \n export const useUserStore = defineStore('user', {\n   state: (): State => {\n     return {\n       userList: [],\n       user: null,\n     }\n   },\n })\n \n interface UserInfo {\n   name: string\n   age: number\n }\n")),(0,r.yg)("p",null,"\u63a5\u4e0b\u6765\u4ecb\u7ecd\u5982\u4f55\u8bbf\u95ee\uff08access\uff09\u72b6\u6001\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u8bfb\u5199\uff08\u771f\u7684\u5047\u7684\ud83c\udf83\uff09"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"const store = useStore()\n store.count++\n")),(0,r.yg)("p",null,"\u6b63\u5e38\u6765\u8bb2\u8fd9\u79cd\u516c\u6709\u72b6\u6001\u7edd\u5bf9\u4e0d\u80fd\u8fd9\u6837\u81ea\u7531\u4fee\u6539\uff0c\u8fd9\u4e00\u4e0b\u5b50\u81ea\u7531\u8fc7\u5934\u8ba9\u4eba\u6709\u4e9b\u96be\u4ee5\u63a5\u53d7\u3002\u4e0d\u8fc7\uff0cstore\u7684\u5c5e\u6027\u5728\u5b9a\u4e49\u91cc\u5c31\u786e\u5b9a\u4e86\uff0c \u60f3\u4e4b\u540e\u518d\u52a0\u662f\u4e0d\u884c\u7684\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'const store = useStore()\n // assume store only have "count" prop \n store.count++ // ok\n store.secondCount = 0 // can\'t do this\n')),(0,r.yg)("p",null,"\u4f60\u53ef\u4ee5\u91cd\u7f6e\u4ed3\u5e93\uff0c\u4f7f\u7528 ",(0,r.yg)("inlineCode",{parentName:"p"},"$reset")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"const store = useStore()\n store.$reset()\n")),(0,r.yg)("p",null,"\u2b50\u914d\u5408option API"),(0,r.yg)("p",null,"\u4e0b\u9762\u7684\u4f8b\u5b50\u91cc\u9ed8\u8ba4\u4f7f\u7528\u8fd9\u6837\u4e00\u4e2a\u4ed3\u5e93\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"// Example File Path:\n // ./src/stores/counter.js\n import { defineStore } from 'pinia'\n export const useCounterStore = defineStore('counter', {\n   state: () => ({\n     count: 0,\n   }),\n })\n")),(0,r.yg)("p",null,"\u5982\u679c\u60a8\u6ca1\u6709\u4f7f\u7528 Composition API\uff0c\u800c\u60a8\u6b63\u5728\u4f7f\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"computed"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"methods"),", ...\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"mapState()"),"\u5e2e\u52a9\u7a0b\u5e8f\u5c06\u72b6\u6001\u5c5e\u6027\u6620\u5c04\u4e3a\u53ea\u8bfb\u8ba1\u7b97\u5c5e\u6027\uff0c\u8fd9\u548cvuex\u91cc\u7c7b\u4f3c\u3002"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { mapState } from 'pinia'\n import { useCounterStore } from '../stores/counter'\n \n export default {\n   computed: {\n     // gives access to this.count inside the component\n     // same as reading from store.count\n     ...mapState(useCounterStore, ['count'])\n     // same as above but registers it as this.myOwnName\n     ...mapState(useCounterStore, {\n       myOwnName: 'count',\n       // you can also write a function that gets access to the store\n       double: store => store.count * 2,\n       // it can have access to this but it won't be typed correctly...\n       magicValue(store) {\n         return store.someGetter + this.count + this.double\n       },\n     }),\n   },\n }\n")),(0,r.yg)("p",null,"\u5982\u679c\u5e0c\u671b\u80fd\u591f\u5199\u5165\u8fd9\u4e9b\u72b6\u6001\u5c5e\u6027\uff08\u4f8b\u5982\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u8868\u5355\uff09\uff0c\u53ef\u4ee5\u6539\u4e3a\u4f7f\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"mapWritableState()"),"\u3002\u6ce8\u610f\uff0c\u4e0d\u80fd\u50cf",(0,r.yg)("inlineCode",{parentName:"p"},"mapState()"),"\u90a3\u65f6\u5019\u4e00\u6837\u5f80\u91cc\u4f20\u51fd\u6570\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { mapWritableState } from 'pinia'\n import { useCounterStore } from '../stores/counter'\n \n export default {\n   computed: {\n     // gives access to this.count inside the component and allows setting it\n     // this.count++\n     // same as reading from store.count\n     ...mapWritableState(useCounterStore, ['count'])\n     // same as above but registers it as this.myOwnName\n     ...mapWritableState(useCounterStore, {\n       myOwnName: 'count',\n     }),\n   },\n }\n")),(0,r.yg)("p",null,"\u9664\u4e86\u4f7f\u7528 \u76f4\u63a5\u6539\u53d8\u5546\u5e97\u5916",(0,r.yg)("inlineCode",{parentName:"p"},"store.count++"),"\uff0c\u8fd8\u53ef\u4ee5\u8c03\u7528\u8be5",(0,r.yg)("inlineCode",{parentName:"p"},"$patch"),"\u65b9\u6cd5\u3002\u5b83\u5141\u8bb8\u5bf9\u90e8\u5206\u5bf9\u8c61\u540c\u65f6\u5e94\u7528\u591a\u4e2a\u66f4\u6539",(0,r.yg)("inlineCode",{parentName:"p"},"state"),"\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"store.$patch({\n   count: store.count + 1,\n   age: 120,\n   name: 'DIO',\n })\n")),(0,r.yg)("p",null,"\u867d\u7136\u4f46\u662f\uff0c\u4f7f\u7528\u6b64\u8bed\u6cd5\u5e94\u7528\u67d0\u4e9b\u53d8\u66f4\u786e\u5b9e\u975e\u5e38\u56f0\u96be\u6216\u4ee3\u4ef7\u9ad8\u6602\uff1a\u4efb\u4f55\u96c6\u5408\u4fee\u6539\uff08\u4f8b\u5982\uff0c\u63a8\u9001\u3001\u5220\u9664\u3001\u62fc\u63a5\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\uff09\u90fd\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u65b0\u96c6\u5408\u3002\u56e0\u6b64\uff0c\u8be5",(0,r.yg)("inlineCode",{parentName:"p"},"$patch"),"\u65b9\u6cd5\u8fd8\u63a5\u53d7\u51fd\u6570\u6765\u5bf9\u8fd9\u79cd\u96be\u4ee5\u5e94\u7528\u8865\u4e01\u5bf9\u8c61\u7684\u7a81\u53d8\u8fdb\u884c\u5206\u7ec4\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"store.$patch((state) => {\n   state.items.push({ name: 'shoes', quantity: 1 })\n   state.hasChanged = true\n })\n")),(0,r.yg)("p",null,"\u4e3b\u8981\u7684\u533a\u522b\u662f ",(0,r.yg)("inlineCode",{parentName:"p"},"$patch()")," \u5141\u8bb8\u4f60\u628a\u591a\u4e2a\u66f4\u6539\u653e\u5230\u8c03\u8bd5\u5de5\u5177\u7684\u4e00\u4e2a\u5355\u5143\u4e2d\uff0c\u8fd9\u4f1a\u5728\u8c03\u8bd5\u90e8\u5206\u518d\u6b21\u63d0\u5230"),(0,r.yg)("p",null,"pinia\u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u66ff\u72b6\u6001\u7684\u8bed\u53e5\uff0c\u4f7f\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"$state="),"\u76f4\u63a5\u5bf9\u4ed3\u5e93\u8d4b\u503c\uff0c\u4f46\u4e8b\u5b9e\u4e0a\u8fd8\u662f\u4f1a\u8f6c\u6362\u6210",(0,r.yg)("inlineCode",{parentName:"p"},"$patch")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"// this doesn't actually replace $state\n store.$state = { count: 24 }\n // it internally calls $patch():\n store.$patch({ count: 24 })\n")),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"You can also ",(0,r.yg)("b",null,"set the initial state")," of your whole application by changing the ",(0,r.yg)("inlineCode",{parentName:"p"},"state")," of the ",(0,r.yg)("inlineCode",{parentName:"p"},"pinia")," instance. This is used during SSR for hydration.\npinia.state.value = {}")),(0,r.yg)("p",null,"\u2b50\u76d1\u63a7\u4e00\u4e2a\u4ed3\u5e93\u7684\u53d8\u5316"),(0,r.yg)("p",null,"\u4f60\u53ef\u4ee5\u4f7f\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"$subscribe()"),"\u65b9\u6cd5\u6765\u89c2\u5bdf\u4e00\u4e2a\u4ed3\u5e93\u7684\u53d8\u5316\uff0c\u7c7b\u4f3c\u4e8evuex\u7684subscribe\u65b9\u6cd5\u3002\u4f7f\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"$subscribe"),"\u800c\u4e0d\u662fwatch\u7684\u597d\u5904\u662f\uff0cpatch\u4e8b\u4ef6\u53ea\u89e6\u53d1\u4e00\u6b21\u3002"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"cartStore.$subscribe((mutation, state) => {\n   // import { MutationType } from 'pinia'\n   mutation.type // 'direct' | 'patch object' | 'patch function'\n   // same as cartStore.$id\n   mutation.storeId // 'cart'\n   // only available with mutation.type === 'patch object'\n   mutation.payload // patch object passed to cartStore.$patch()\n \n   // persist the whole state to the local storage whenever it changes\n   localStorage.setItem('cart', JSON.stringify(state))\n })\n")),(0,r.yg)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c",(0,r.yg)("em",null,"\u72b6\u6001subscribe")," \u7ed1\u5b9a\u5230\u6dfb\u52a0\u5b83\u4eec\u7684\u7ec4\u4ef6\uff08\u5982\u679c\u5b58\u50a8\u5728\u7ec4\u4ef6\u7684\u5185\u90e8",(0,r.yg)("inlineCode",{parentName:"p"},"setup()"),"\uff09\u3002\u5f53\u7ec4\u4ef6\u88ab\u5378\u8f7d\u65f6\uff0c\u5b83\u4eec\u5c06\u88ab\u81ea\u52a8\u5220\u9664\u3002"),(0,r.yg)("p",null,"\u5982\u679c\u8fd8\u60f3\u5728\u5378\u8f7d\u7ec4\u4ef6\u540e\u4fdd\u7559subscribe\uff0c\u8bf7",(0,r.yg)("inlineCode",{parentName:"p"},"{ detached: true }"),"\u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f20\u9012\u4ee5\u4ece\u5f53\u524d\u7ec4\u4ef6",(0,r.yg)("em",null,"\u5206\u79bb\u72b6\u6001"),"\u8ba2\u9605",(0,r.yg)("i",null,"\uff1a")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export default {\n   setup() {\n     const someStore = useSomeStore()\n \n     // this subscription will be kept even after the component is unmounted\n     someStore.$subscribe(callback, { detached: true })\n \n     // ...\n   },\n }\n")),(0,r.yg)("h5",{id:"getter"},(0,r.yg)("b",null,"Getter")),(0,r.yg)("p",null,"getter\u5b8c\u5168\u7b49\u4ef7\u4e8e\u72b6\u6001\u7684computed\u503c\uff0c\u9f13\u52b1\u4f7f\u7528\u7bad\u5934\u51fd\u6570\u3002"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export const useCounterStore = defineStore('counter', {\n   state: () => ({\n     count: 0,\n   }),\n   getters: {\n     doubleCount: (state) => state.count * 2,\n   },\n })\n")),(0,r.yg)("p",null,"\u5927\u591a\u6570\u65f6\u5019\uff0cgetters \u53ea\u4f1a\u4f9d\u8d56\u4e8e\u72b6\u6001\uff0c\u4f46\u662f\uff0c\u4ed6\u4eec\u4e5f\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u5176\u4ed6 getters\uff0c\u8fd9\u79cd\u65f6\u5019",(0,r.yg)("b",null,"\u5fc5\u987b"),"\u6307\u660e\u7c7b\u578b\uff08\u5176\u5b9e\u662fTS\u7684\u9650\u5236\uff09\uff0c\u6ce8\u610f\u8fd9\u4e0d\u5f71\u54cd\u4f7f\u7528\u7bad\u5934\u51fd\u6570\u7684getter\u6216\u8005\u6ca1\u6709\u4f7f\u7528\u5230this\u7684getter\uff0c\u5982\u4e0b"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export const useCounterStore = defineStore('counter', {\n   state: () => ({\n     count: 0,\n   }),\n   getters: {\n     // automatically infers the return type as a number\n     doubleCount(state) {\n       return state.count * 2\n     },\n     // the return type <b>must</b> be explicitly set\n     doublePlusOne(): number {\n       // autocompletion and typings for the whole store \u2728\n       return this.doubleCount + 1\n     },\n   },\n })\n")),(0,r.yg)("p",null,"\u4e4b\u540e\u4f60\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u4ed3\u5e93\u5b9e\u4f8b\u8bbf\u95eegetter\u4e86"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"<template>\n   <p>Double count is {{ store.doubleCount }}</p>\n </template>\n \n <script>\n export default {\n   setup() {\n     const store = useCounterStore()\n \n     return { store }\n   },\n }\n <\/script>\n")),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"\u5373\u4f7f\u4e0d\u7528ts\uff0c\u4e5f\u662f\u53ef\u4ee5\u8bbf\u95ee\u5176\u4ed6getter\u7684\uff0cjsdoc\u53ef\u4ee5\u505a\u7c7b\u578b"),(0,r.yg)("pre",{parentName:"blockquote"},(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export const useCounterStore = defineStore('counter', {\n state: () => ({\n  count: 0,\n }),\n getters: {\n  // type is automatically inferred because we are not using this\n  doubleCount: (state) => state.count * 2,\n  // here we need to add the type ourselves (using JSDoc in JS). We can also\n  // use this to document the getter\n  /**\n      * Returns the count value times two plus one.\n      *\n      * @returns {number}\n      */\n     doubleCountPlusOne() {\n       // autocompletion \u2728\n       return this.doubleCount + 1\n     },\n   },\n })\n"))),(0,r.yg)("p",null,"\u2b50\u600e\u4e48\u7ed9getter\u4f20\u53c2"),(0,r.yg)("p",null,"\u4e00\u822c\u6765\u8bb2\u8fd9\u662f\u505a\u4e0d\u5230\u7684\uff0c\u56e0\u4e3agetter\u5b8c\u5168\u5c31\u662fcomputed\uff0c\u4f46\u662f\u6211\u4eec\u603b\u662f\u53ef\u4ee5\u7528\u51fd\u6570\u60f3\u60f3\u529e\u6cd5\uff0c\u4f8b\u5982\u8ba9getter\u8fd4\u56de\u4e00\u4e2a\u51fd\u6570"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export const useStore = defineStore('main', {\n   getters: {\n     getUserById: (state) => {\n       return (userId) => state.users.find((user) => user.id === userId)\n     },\n   },\n })\n")),(0,r.yg)("p",null,"w\uff0c\u6ca1\u6709vue "),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"<script>\n export default {\n   setup() {\n     const store = useStore()\n \n     return { getUserById: store.getUserById }\n   },\n }\n <\/script>\n \n <template>\n   <p>User 2: {{ getUserById(2) }}</p>\n </template>\n")),(0,r.yg)("p",null,"\u8fd9\u662f\u53ef\u884c\u7684\uff0c\u4f46\u662f\u8fd9\u4e0b\u5b50getter\u4e0d\u4f1a\u8fdb\u7f13\u5b58\uff0c\u56e0\u4e3a\u8fd9\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\u4e86\uff0c\u5982\u679c\u9700\u8981\u6027\u80fd\uff0c\u9700\u8981\u624b\u52a8cache\uff0c\u4e00\u4e2a\u4e0d\u592a\u5bfb\u5e38\u7684\u65b9\u6cd5\u662f\u5728getter\u91cc\u9762\u52a0\u4e1c\u897f"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export const useStore = defineStore('main', {\n   getters: {\n     getActiveUserById(state) {\n       //new \u2193\n       const activeUsers = state.users.filter((user) => user.active)\n       return (userId) => activeUsers.find((user) => user.id === userId)\n     },\n   },\n })\n")),(0,r.yg)("p",null,"\u2b50\u4f7f\u7528\u5176\u4ed6\u4ed3\u5e93\u7684getter"),(0,r.yg)("p",null,"\u6ca1\u6709\u95ee\u9898\uff0c\u521b\u5efa\u597d\u5176\u4ed6\u4ed3\u5e93\u7684\u5b9e\u4f8b\u76f4\u63a5\u7528"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { useOtherStore } from './other-store'\n \n export const useStore = defineStore('main', {\n   state: () => ({\n     // ...\n   }),\n   getters: {\n     otherGetter(state) {\n       const otherStore = useOtherStore()\n       return state.localData + otherStore.data\n     },\n   },\n })\n")),(0,r.yg)("p",null,"\u2b50\u5728setup\u4e2d\u4f7f\u7528"),(0,r.yg)("p",null,"\u628agetter\u770b\u6210\u5c5e\u6027\uff0c\u76f4\u63a5\u8bbf\u95ee"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export default {\n   setup() {\n     const store = useCounterStore()\n \n     store.count = 3\n     store.doubleCount // 6\n   },\n }\n")),(0,r.yg)("p",null,"\u4e4d\u4e00\u770b\u6709\u70b9\u5938\u5f20\uff0c\u4e0d\u8fc7getter\u5728setup\u4e2d\u5c31\u662f\u8fd9\u6837\u7684"),(0,r.yg)("p",null,"\u2b50\u5728option\u4e2d\u4f7f\u7528"),(0,r.yg)("p",null,"\u5047\u8bbe\u6211\u4eec\u7684option store \u5b9a\u4e49\u5982\u4e0b"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"// Example File Path:\n // ./src/stores/counter.js\n \n import { defineStore } from 'pinia'\n \n export const useCounterStore = defineStore('counter', {\n   state: () => ({\n     count: 0,\n   }),\n   getters: {\n     doubleCount(state) {\n       return state.count * 2\n     },\n   },\n })\n")),(0,r.yg)("p",null,"\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u4f7f\u7528setup hook \uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u6620\u5c04\u51fd\u6570\u6765\u5e2e\u5fd9"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { useCounterStore } from '../stores/counter'\n \n export default {\n   setup() {\n     const counterStore = useCounterStore()\n \n     return { counterStore }\n   },\n   computed: {\n     quadrupleCounter() {\n       return this.counterStore.doubleCount * 2\n     },\n   },\n }\n")),(0,r.yg)("p",null,"\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u4e0d\u7528setup\uff0c\u90a3\u4e48\u5c31\u7528map\u51fd\u6570"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { mapState } from 'pinia'\n import { useCounterStore } from '../stores/counter'\n \n export default {\n   computed: {\n     // gives access to this.doubleCount inside the component\n     // same as reading from store.doubleCount\n     ...mapState(useCounterStore, ['doubleCount']),\n     // same as above but registers it as this.myOwnName\n     ...mapState(useCounterStore, {\n       myOwnName: 'doubleCount',\n       // you can also write a function that gets access to the store\n       double: (store) => store.doubleCount,\n     }),\n   },\n }\n")),(0,r.yg)("h5",{id:"actions"},(0,r.yg)("b",null,"Actions")),(0,r.yg)("p",null,"action\u548c\u65b9\u6cd5\uff08method\uff09\u7b49\u4ef7\uff0caction\u975e\u5e38\u9002\u5408\u6765\u5b9a\u4e49\u4e1a\u52a1\u903b\u8f91\u3002"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export const useCounterStore = defineStore('counter', {\n   state: () => ({\n     count: 0,\n   }),\n   actions: {\n     // since we rely on this, we cannot use an arrow function\n     increment() {\n       this.count++\n     },\n     randomizeCounter() {\n       this.count = Math.round(100 * Math.random())\n     },\n   },\n })\n")),(0,r.yg)("p",null,"\u548cgetter\u7c7b\u4f3c\uff0caction\u53ef\u4ee5\u901a\u8fc7this\u8bbf\u95ee\u6574\u4e2a\u4ed3\u5e93\u5b9e\u4f8b\uff0c\u800c\u4e14\u6709\u5b8c\u5168\u7684\u7c7b\u578b\u652f\u6301\uff08\u548c\u81ea\u52a8\u8865\u5168\uff09\u3002\u548cgetter\u5e76\u4e0d\u4e00\u6837\uff0caction\u53ef\u4ee5\u662f\u5f02\u6b65\u7684\uff0c\u6bd4\u65b9\u8bf4\u4f7f\u7528await\uff0c\u6216\u8005\u5d4c\u5957action\u3002"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"actions: {\n     async registerUser(login, password) {\n       try {\n         this.userData = await api.post({ login, password })\n         showTooltip(Welcome back ${this.userData.name}!)\n       } catch (error) {\n         showTooltip(error)\n         // let the form component display the error\n         return error\n       }\n     },\n   },\n")),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"You are also completely free to set whatever arguments you want and return anything. When calling actions, everything will be automatically inferred!")),(0,r.yg)("p",null,"action\u7684\u89e6\u53d1\u4e5f\u548cmethod\u4e00\u6837\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export default defineComponent({\n   setup() {\n     const store = useCounterStore()\n     // call the action as a method of the store\n     store.randomizeCounter()\n \n     return {}\n   },\n })\n")),(0,r.yg)("p",null,"\u4f60\u53ef\u80fd\u5df2\u7ecf\u731c\u5230\u4e86\uff0caction\u4e2d\u53ef\u4ee5\u81ea\u7531\u8bbf\u95ee\u5176\u4ed6\u4ed3\u5e93\u7684action\uff0c\u53ea\u8981\u521b\u5efa\u5bf9\u5e94\u4ed3\u5e93\u7684\u5b9e\u4f8b"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { useAuthStore } from './auth-store'\n \n export const useSettingsStore = defineStore('settings', {\n   state: () => ({\n     preferences: null,\n     // ...\n   }),\n   actions: {\n     async fetchUserPreferences() {\n       const auth = useAuthStore()\n       if (auth.isAuthenticated) {\n         this.preferences = await fetchPreferences()\n       } else {\n         throw new Error('User must be authenticated')\n       }\n     },\n   },\n })\n")),(0,r.yg)("p",null,"\u2b50setup\u4e2d\u4f7f\u7528action"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export default {\n   setup() {\n     const store = useCounterStore()\n \n     store.randomizeCounter()\n   },\n }\n")),(0,r.yg)("p",null,"\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728\u51fd\u6570\u4e2d\u8c03\u7528action"),(0,r.yg)("p",null,"\u2b50\u914d\u5408optionAPI\u4f7f\u7528"),(0,r.yg)("p",null,"\u4e0b\u9762\u7684\u4ee3\u7801\u9ed8\u8ba4\u4f7f\u7528\u8fd9\u4e2a\u4ed3\u5e93\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"// Example File Path:\n // ./src/stores/counter.js\n \n import { defineStore } from 'pinia'\n \n export const useCounterStore = defineStore('counter', {\n   state: () => ({\n     count: 0\n   }),\n   actions: {\n     increment() {\n       this.count++\n     }\n   }\n })\n")),(0,r.yg)("p",null,"\u6709setup\u60c5\u51b5\uff1a"),(0,r.yg)("p",null,"\u548cgetter\u7684\u60c5\u51b5\u5b8c\u5168\u76f8\u540c\uff0csetup hook\u4f7f\u5f97\u4e0d\u9700\u8981map\u51fd\u6570\u4ee3\u7801\u5c31\u80fd\u5de5\u4f5c"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { useCounterStore } from '../stores/counter'\n \n export default {\n   setup() {\n     const counterStore = useCounterStore()\n \n     return { counterStore }\n   },\n   methods: {\n     incrementAndPrint() {\n       this.counterStore.increment()\n       console.log('New Count:', this.counterStore.count)\n     },\n   },\n }\n")),(0,r.yg)("p",null,"\u65e0setup\u60c5\u51b5\uff1a"),(0,r.yg)("p",null,"\u5982\u679c\u6839\u672c\u4e0d\u60f3\u4f7f\u7528 Composition API\uff0c\u90a3\u53ef\u4ee5\u4f7f\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"mapActions()"),"\u5e2e\u52a9\u7a0b\u5e8f\u5c06\u64cd\u4f5c\u5c5e\u6027\u6620\u5c04\u4e3a\u7ec4\u4ef6\u4e2d\u7684\u65b9\u6cd5\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { mapActions } from 'pinia'\n import { useCounterStore } from '../stores/counter'\n \n export default {\n   methods: {\n     // gives access to this.increment() inside the component\n     // same as calling from store.increment()\n     ...mapActions(useCounterStore, ['increment'])\n     // same as above but registers it as this.myOwnName()\n     ...mapActions(useCounterStore, { myOwnName: 'increment' }),\n   },\n }\n")),(0,r.yg)("p",null,"\u2b50\u76d1\u63a7action"),(0,r.yg)("p",null,"\u53ef\u4ee5\u4f7f\u7528 ",(0,r.yg)("inlineCode",{parentName:"p"},"store.$onAction()"),"\u89c2\u5bdfaction\u53ca\u5176\u7ed3\u679c\u3002\u4f20\u9012\u7ed9\u5b83\u7684\u56de\u8c03\u5728\u4f1a\u64cd\u4f5c\u672c\u8eab\u4e4b\u524d\u6267\u884c\u3002",(0,r.yg)("inlineCode",{parentName:"p"},"after"),"\u5904\u7406promise\u5e76\u5141\u8bb8\u5728action resolve\u540e\u6267\u884c\u529f\u80fd\u3002\u4ee5\u7c7b\u4f3c\u7684\u65b9\u5f0f\uff0c",(0,r.yg)("inlineCode",{parentName:"p"},"onError"),"\u5141\u8bb8\u60a8\u5728\u64cd\u4f5c\u629b\u51fa\u6216\u62d2\u7edd\u65f6\u6267\u884c\u51fd\u6570\u3002\u8fd9\u4e9b\u5bf9\u4e8e\u5728\u8fd0\u884c\u65f6\u8ddf\u8e2a\u9519\u8bef\u5f88\u6709\u7528\uff0c\u5177\u4f53\u8fd8\u662f\u770b\u4ee3\u7801\u4f8b\u5b50"),(0,r.yg)("p",null,"\u8fd9\u662f\u4e00\u4e2a\u5728\u8fd0\u884c\u64cd\u4f5c\u4e4b\u524d\u548c\u5b83\u4eec\u89e3\u51b3/\u62d2\u7edd\u4e4b\u540e\u8bb0\u5f55\u7684\u793a\u4f8b\u3002"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'const unsubscribe = someStore.$onAction(\n   ({\n     name, // name of the action\n     store, // store instance, same as someStore\n     args, // array of parameters passed to the action\n     after, // hook after the action returns or resolves\n     onError, // hook if the action throws or rejects\n   }) => {\n     // a shared variable for this specific action call\n     const startTime = Date.now()\n     // this will trigger before an action on store is executed\n     console.log(Start "${name}" with params [${args.join(\', \')}].)\n \n     // this will trigger if the action succeeds and after it has fully run.\n     // it waits for any returned promised\n     after((result) => {\n       console.log(\n         Finished "${name}" after ${\n           Date.now() - startTime\n         }ms.\\nResult: ${result}.\n       )\n     })\n \n     // this will trigger if the action throws or returns a promise that rejects\n     onError((error) => {\n       console.warn(\n         Failed "${name}" after ${Date.now() - startTime}ms.\\nError: ${error}.\n       )\n     })\n   }\n )\n \n // manually remove the listener\n unsubscribe()\n')),(0,r.yg)("p",null,"\u548cstate\u4e00\u6837\uff0c\u8fd9\u4e2asubscribe\u4e5f\u4f1a\u6302\u5230\u7ec4\u4ef6\u4e0a\uff0c\u6240\u4ee5\u7ec4\u4ef6\u53d6\u6d88\u6302\u8f7d\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u6d88\u5931\u3002\u5982\u679c\u60f3\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u5c06",(0,r.yg)("inlineCode",{parentName:"p"},"true"),"\u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f20\u9012\u4ee5\u4ece\u5f53\u524d\u7ec4\u4ef6",(0,r.yg)("em",null,"\u5206\u79bb"),"\u64cd\u4f5c",(0,r.yg)("em",null,"\u8ba2\u9605")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export default {\n   setup() {\n     const someStore = useSomeStore()\n \n     // this subscription will be kept even after the component is unmounted\n     someStore.$onAction(callback, true)\n \n     // ...\n   },\n }\n")),(0,r.yg)("h5",{id:"\u4f7f\u7528\u63d2\u4ef6"},(0,r.yg)("b",null,"\u4f7f\u7528\u63d2\u4ef6")),(0,r.yg)("p",null,"\u529f\u80fd\u4e0a\u6765\u8bb2\u6709\u4e86state\uff0cgetter\u548caction\uff0c\u4e00\u4e2a\u4ed3\u5e93\u4e5f\u5c31\u80fd\u6295\u5165\u4f7f\u7528\u4e86\uff0c\u4e0d\u8fc7\uff0c\u679c\u7136\u8fd8\u662f\u5e0c\u671b\u6709\u4e00\u4e9b\u63d2\u4ef6\u6765\u63d0\u4f9b\u8f85\u52a9\u529f\u80fd\u3002\u7531\u4e8epinia\u7684API\u6bd4\u8f83\u5e95\u5c42\uff0c\u6240\u4ee5\u63d2\u4ef6\u652f\u6301\u975e\u5e38\u4e0d\u9519\u3002"),(0,r.yg)("p",null,"\u4f60\u53ef\u4ee5\u505a\u5230\uff1a"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Add new properties to stores"),(0,r.yg)("li",{parentName:"ul"},"Add new options when defining stores"),(0,r.yg)("li",{parentName:"ul"},"Add new methods to stores"),(0,r.yg)("li",{parentName:"ul"},"Wrap existing methods"),(0,r.yg)("li",{parentName:"ul"},"Change or even cancel actions"),(0,r.yg)("li",{parentName:"ul"},"Implement side effects like Local Storage"),(0,r.yg)("li",{parentName:"ul"},"Apply ",(0,r.yg)("b",null,"only")," to specific stores")),(0,r.yg)("p",null,"Pinia\u4e2d\u4f7f\u7528\u63d2\u4ef6\u7684\u65b9\u6cd5\u5c31\u662f\u5229\u7528 ",(0,r.yg)("inlineCode",{parentName:"p"},"pinia.use()"),"\u51fd\u6570\uff0c\u6700\u7b80\u5355\u7684\u4f8b\u5b50\u662f\u5f80\u6240\u6709\u4ed3\u5e93\u4e2d\u6dfb\u52a0\u4e00\u4e2astatic\u5c5e\u6027\u3002"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { createPinia } from 'pinia'\n \n // add a property named secret to every store that is created after this plugin is installed\n // this could be in a different file\n function SecretPiniaPlugin() {\n   return { secret: 'the cake is a lie' }\n }\n \n const pinia = createPinia()\n // give the plugin to pinia\n pinia.use(SecretPiniaPlugin)\n \n // in another file\n const store = useStore()\n store.secret // 'the cake is a lie'\n")),(0,r.yg)("p",null,"\u522b\u8bf4\u8fd8\u633a\u6709\u7528\u7684\uff0c\u8fd9\u6837\u53ef\u4ee5\u505a\u5230\u6dfb\u52a0\u5168\u5c40router, modal\u6216\u8005\u662f toast managers"),(0,r.yg)("p",null,"\u2b50\u7b80\u4ecb"),(0,r.yg)("p",null,"Pinia \u63d2\u4ef6\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u8fd4\u56de\u8981\u6dfb\u52a0\u5230\u5546\u5e97\u7684\u5c5e\u6027\u3002\u5b83\u6709",(0,r.yg)("b",null,"\u4e00\u4e2a"),"\u53ef\u9009\u53c2\u6570\uff0c\u4e00\u4e2acontext(\u4e0a\u4e0b\u6587)"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export function myPiniaPlugin(context) {\n   context.pinia // the pinia created with createPinia()\n   context.app // the current app created with createApp() (Vue 3 only)\n   context.store // the store the plugin is augmenting\n   context.options // the options object defining the store passed to defineStore()\n   // ...\n }\n")),(0,r.yg)("p",null,"\u7136\u540e\u5c06\u6b64\u51fd\u6570\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"pinia.use()"),"\u4f20\u9012\u7ed9",(0,r.yg)("inlineCode",{parentName:"p"},"pinia"),"\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"pinia.use(myPiniaPlugin)\n")),(0,r.yg)("p",null,"\u6ce8\u610f\uff0cPlugins \u4ec5\u9002\u7528\u4e8e\u5728\u63d2\u4ef6\u672c\u8eab\u4e4b\u540e\u521b\u5efa\u7684\u5546\u5e97\uff0c\u5e76\u4e14 \u9700\u8981\u5728\u8fd9\u4e4b\u524d\u628a",(0,r.yg)("inlineCode",{parentName:"p"},"pinia"),"\u4f20\u9012\u7ed9 app\uff0c\u5426\u5219\u5b83\u4eec\u5c06\u4e0d\u4f1a\u88ab\u5e94\u7528\u3002"),(0,r.yg)("p",null,"\u2b50\u6269\u5145\u4ed3\u5e93"),(0,r.yg)("p",null,"\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u5730\u5728\u63d2\u4ef6\u4e2d\u8fd4\u56de\u5bf9\u8c61\u6765\u5411\u6bcf\u4e2a\u5546\u5e97\u6dfb\u52a0\u5c5e\u6027\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"pinia.use(() => ({ hello: 'world' }))\n")),(0,r.yg)("p",null,"\u60a8\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728 store\u4e0a\u8bbe\u7f6e\u5c5e\u6027\uff0c\u4f46\u5982\u679c\u53ef\u80fd\uff0c\u8bf7\u4f7f\u7528\u8fd4\u56de\u7248\u672c\uff0c\u56e0\u4e3a\u8fd9\u6837 devtools \u53ef\u4ee5\u81ea\u52a8\u8ddf\u8e2a\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"pinia.use(({ store }) => {\n   store.hello = 'world'\n })\n")),(0,r.yg)("em",null,"\u63d2\u4ef6\u8fd4\u56de"),"\u7684\u4efb\u4f55\u5c5e\u6027\u90fd\u4f1a\u88ab devtools \u81ea\u52a8\u8ddf\u8e2a\uff0c\u56e0\u6b64\u4e3a\u4e86`hello`\u5728 devtools \u4e2d\u53ef\u89c1\uff0c\u8bf7\u786e\u4fdd\u4ec5\u5f53\u60a8\u60f3\u5728 devtools \u4e2d\u8c03\u8bd5\u5b83\u65f6\u624d\u5c06\u5176\u6dfb\u52a0\u5230`store._customProperties` ",(0,r.yg)("b",null,"\u5f00\u53d1\u6a21\u5f0f\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"// from the example above\n pinia.use(({ store }) => {\n   store.hello = 'world'\n   // make sure your bundler handle this. webpack and vite should do it by default\n   if (process.env.NODE_ENV === 'development') {\n     // add any keys you set on the store\n     store._customProperties.add('hello')\n   }\n })\n")),(0,r.yg)("p",null,"\u6ce8\u610f\u6240\u6709\u4ed3\u5e93\u90fd\u662freactive\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4f1a\u81ea\u52a8\u89e3\u5f00ref\uff0ccomputed\u7b49\u7b49\u3002"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"const sharedRef = ref('shared')\n pinia.use(({ store }) => {\n   // each store has its individual hello property\n   store.hello = ref('secret')\n   // it gets automatically unwrapped\n   store.hello // 'secret'\n \n   // all stores are sharing the value shared property\n   store.shared = sharedRef\n   store.shared // 'shared'\n })\n")),(0,r.yg)("p",null,"\u8fd9\u89e3\u91ca\u4e86\u4e4b\u524dpinia\u4e3a\u4ec0\u4e48\u770b\u8d77\u6765\u975e\u5e38\u76f4\u7403\uff0c\u4e0d\u7528",(0,r.yg)("inlineCode",{parentName:"p"},".value"),"\uff0c\u8fd8\u6709\u795e\u5947\u7684\u8bfb\u5199\u3002"),(0,r.yg)("p",null,"\u2b50\u6dfb\u52a0\u65b0\u7684state"),(0,r.yg)("p",null,"\u5982\u679c\u8981\u5c06\u65b0\u7684\u72b6\u6001\u5c5e\u6027\u6dfb\u52a0\u5230\u5546\u5e97\u6216\u8981\u5728hydrate\u671f\u95f4\u4f7f\u7528\u7684\u5c5e\u6027\uff0c",(0,r.yg)("b",null,"\u5219\u5fc5\u987b\u5c06\u5176\u6dfb\u52a0\u5230\u4e24\u4e2a\u5730\u65b9"),"\uff1a"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"On the ",(0,r.yg)("inlineCode",{parentName:"li"},"store")," so you can access it with ",(0,r.yg)("inlineCode",{parentName:"li"},"store.myState")),(0,r.yg)("li",{parentName:"ul"},"On ",(0,r.yg)("inlineCode",{parentName:"li"},"store.$state")," so it can be used in devtools and, ",(0,r.yg)("b",null,"be serialized during SSR"),".")),(0,r.yg)("p",null,"\u6b64\u5916\u8fd8\u5fc5\u987b\u8981\u6dfb\u52a0ref\u6765\u7ef4\u6301\u503c\u7684\u4e00\u81f4\u6027"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { toRef, ref } from 'vue'\n \n pinia.use(({ store }) => {\n   // to correctly handle SSR, we need to make sure we are not overriding an\n   // existing value\n   if (!Object.prototype.hasOwnProperty(store.$state, 'hasError')) {\n     // hasError is defined within the plugin, so each store has their individual\n     // state property\n     const hasError = ref(false)\n     // setting the variable on $state, allows it be serialized during SSR\n     store.$state.hasError = hasError\n   }\n   // we need to transfer the ref from the state to the store, this way\n   // both accesses: store.hasError and store.$state.hasError will work\n   // and share the same variable\n   // See https://vuejs.org/api/reactivity-utilities.html#toref\n   store.hasError = toRef(store.$state, 'hasError')\n \n   // in this case it's better not to return hasError since it\n   // will be displayed in the state section in the devtools\n   // anyway and if we return it, devtools will display it twice.\n })\n")),(0,r.yg)("p",null,"\u8bf7\u6ce8\u610f\uff0c\u63d2\u4ef6\u4e2d\u53d1\u751f\u7684\u72b6\u6001\u66f4\u6539\u6216\u6dfb\u52a0\uff08\u5305\u62ec\u8c03\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"store.$patch()"),"\uff09\u53d1\u751f\u5728\u5b58\u50a8\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u4e4b\u524d\uff0c\u56e0\u6b64\u4e0d\u4f1a\u89e6\u53d1\u4efb\u4f55\u8ba2\u9605\u3002"),(0,r.yg)("p",null,"\u2b50\u6dfb\u52a0\u65b0\u7684\u5916\u90e8\u5c5e\u6027"),(0,r.yg)("p",null,"\u5f53\u6dfb\u52a0\u5916\u90e8\u5c5e\u6027\u3001\u6765\u81ea\u5176\u4ed6\u5e93\u7684\u7c7b\u5b9e\u4f8b\uff0c\u6216\u8005\u4ec5\u4ec5\u662f\u975e\u53cd\u5e94\u6027\u7684\u4e1c\u897f\u65f6\uff0c\u60a8\u5e94\u8be5\u5728\u5c06\u5bf9\u8c61\u4f20\u9012\u7ed9 pinia \u4e4b\u524d\u5c06\u5176\u7528",(0,r.yg)("inlineCode",{parentName:"p"},"markRaw()"),"\u5305\u88c5\u8d77\u6765\u3002"),(0,r.yg)("p",null,"\u4f8b\u5b50\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { markRaw } from 'vue'\n // adapt this based on where your router is\n import { router } from './router'\n \n pinia.use(({ store }) => {\n   store.router = markRaw(router)\n })\n")),(0,r.yg)("p",null,"\u2b50\u63d2\u4ef6\u4e2d\u4f7f\u7528\u8ba2\u9605"),(0,r.yg)("p",null,"\u6ca1\u6709\u95ee\u9898\uff0c\u7528\u5c31\u5b8c\u4e86"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"pinia.use(({ store }) => {\n   store.$subscribe(() => {\n     // react to store changes\n   })\n   store.$onAction(() => {\n     // react to store actions\n   })\n })\n")),(0,r.yg)("p",null,"\u2b50\u6dfb\u52a0\u65b0\u7684option"),(0,r.yg)("p",null,"\u5728defineStore\u91cc\u9762\uff0c\u4f60\u53ef\u4ee5\u6dfb\u52a0state\uff0cgetter\uff0caction\u4ee5\u5916\u7684option\uff0c\u8fd9\u4e9b\u65b0\u7684option\u88ab\u63d2\u4ef6\u5229\u7528"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"defineStore('search', {\n   actions: {\n     searchContacts() {\n       // ...\n     },\n   },\n \n   // this will be read by a plugin later on\n   debounce: {\n     // debounce the action searchContacts by 300ms\n     searchContacts: 300,\n   },\n })\n")),(0,r.yg)("p",null,"\u63d2\u4ef6\u53ef\u4ee5\u8bfb\u53d6\u8be5\u9009\u9879\u4ee5\u5305\u88c5\u64cd\u4f5c\u5e76\u66ff\u6362\u539f\u59cb\u64cd\u4f5c\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"// use any debounce library\n import debounce from 'lodash/debounce'\n \n pinia.use(({ options, store }) => {\n   if (options.debounce) {\n     // we are overriding the actions with new ones\n     return Object.keys(options.debounce).reduce((debouncedActions, action) => {\n       debouncedActions[action] = debounce(\n         store[action],\n         options.debounce[action]\n       )\n       return debouncedActions\n     }, {})\n   }\n })\n")),(0,r.yg)("p",null,"\u2b50TS"),(0,r.yg)("p",null,"\u4e4b\u524d\u63d0\u5230\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u6709ts\u652f\u6301\uff0c\u4f60\u751a\u81f3\u4e0d\u9700\u8981\u4f7f\u7528 ",(0,r.yg)("inlineCode",{parentName:"p"},"any")," \u6216\u8005 ",(0,r.yg)("inlineCode",{parentName:"p"},"@ts-ignore"),"."),(0,r.yg)("p",null,"\u603b\u4e4b\u8fd8\u662f\u770b\u770b\u548c\u63d2\u4ef6\u76f8\u5173\u7684ts\u5185\u5bb9\u3002"),(0,r.yg)("p",null,"\u2b50\u2b50type \u63d2\u4ef6"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { PiniaPluginContext } from 'pinia'\n \n export function myPiniaPlugin(context: PiniaPluginContext) {\n   // ...\n }\n")),(0,r.yg)("p",null,"\u2b50\u2b50type \u65b0\u7684state\u5c5e\u6027"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import 'pinia'\n \n declare module 'pinia' {\n   export interface PiniaCustomProperties {\n     // by using a setter we can allow both strings and refs\n     set hello(value: string | Ref<string>)\n     get hello(): string\n \n     // you can define simpler values too\n     simpleNumber: number\n   }\n }\n")),(0,r.yg)("p",null,"\u5411\u5546\u5e97\u6dfb\u52a0\u65b0\u5c5e\u6027\u65f6\uff0c\u8fd8\u5e94\u8be5\u6269\u5c55",(0,r.yg)("inlineCode",{parentName:"p"},"PiniaCustomProperties"),"\u63a5\u53e3\ud83d\udc46"),(0,r.yg)("p",null,"\u7136\u540e\u5c31\u53ef\u4ee5\u5b89\u5168\u5730\u5199\u5165\u548c\u8bfb\u53d6\u4e86"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"pinia.use(({ store }) => {\n   store.hello = 'Hola'\n   store.hello = ref('Hola')\n \n   store.simpleNumber = Math.random()\n   // @ts-expect-error: we haven't typed this correctly\n   store.simpleNumber = ref(Math.random())\n })\n")),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"PiniaCustomProperties"),"\u662f\u4e00\u79cd\u901a\u7528\u7c7b\u578b\uff0c\u5141\u8bb8\u4f60\u5f15\u7528\u5546\u5e97\u7684\u5c5e\u6027\u3002"),(0,r.yg)("p",null,"\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u5c06\u521d\u59cb\u9009\u9879\u590d\u5236\u4e3a",(0,r.yg)("inlineCode",{parentName:"p"},"$options"),"\uff08\u4ec5\u9002\u7528\u4e8e\u9009\u9879\u5546\u5e97\uff09\uff1a"),(0,r.yg)("p",null," pinia.use(({ options }) =",">"," ({ $options: options }))"),(0,r.yg)("p",null,"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b 4 \u79cd\u901a\u7528\u7c7b\u578b\u6765\u6b63\u786e\u952e\u5165\u5b83\uff08",(0,r.yg)("inlineCode",{parentName:"p"},"PiniaCustomProperties"),"\uff09\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import 'pinia'\n \n declare module 'pinia' {\n   export interface PiniaCustomProperties<Id, S, G, A> {\n     $options: {\n       id: Id\n       state?: () => S\n       getters?: G\n       actions?: A\n     }\n   }\n }\n")),(0,r.yg)("p",null,"SGA\u8fd9\u4e9b\u5fc5\u987b\u548c\u6e90\u7801\u4e2d\u5b8c\u5168\u4e00\u6837\uff0c\u6bd5\u7adf\u662f\u4eba\u5bb6\u5199\u597d\u7684\uff0c\u539f\u6587\u5982\u4e0b"),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"\u63d0\u793a\n\u5728\u6cdb\u578b\u4e2d\u6269\u5c55\u7c7b\u578b\u65f6\uff0c\u5b83\u4eec\u7684\u547d\u540d\u5fc5\u987b",(0,r.yg)("b",null,"\u4e0e\u6e90\u4ee3\u7801\u4e2d\u7684\u5b8c\u5168\u76f8\u540c"),"\u3002",(0,r.yg)("inlineCode",{parentName:"p"},"Id"),"\u4e0d\u80fd\u547d\u540d\u4e3a",(0,r.yg)("inlineCode",{parentName:"p"},"id"),"\u6216",(0,r.yg)("inlineCode",{parentName:"p"},"I"),"\uff0c\u4e5f",(0,r.yg)("inlineCode",{parentName:"p"},"S"),"\u4e0d\u80fd\u547d\u540d\u4e3a",(0,r.yg)("inlineCode",{parentName:"p"},"State"),"\u3002\u8fd9\u662f\u6bcf\u4e2a\u5b57\u6bcd\u4ee3\u8868\u7684\u610f\u601d\uff1a"),(0,r.yg)("ul",{parentName:"blockquote"},(0,r.yg)("li",{parentName:"ul"},"S\uff1astate"),(0,r.yg)("li",{parentName:"ul"},"G\uff1agetter"),(0,r.yg)("li",{parentName:"ul"},"A\uff1aaction"),(0,r.yg)("li",{parentName:"ul"},"SS\uff1asetupStore/store"))),(0,r.yg)("p",null,"\u2b50\u2b50type \u65b0\u72b6\u6001"),(0,r.yg)("p",null,"\u6dfb\u52a0\u65b0\u7684\u72b6\u6001\u5c5e\u6027\uff08\u540c\u65f6\u6dfb\u52a0\u5230",(0,r.yg)("inlineCode",{parentName:"p"},"store"),"\u548c",(0,r.yg)("inlineCode",{parentName:"p"},"store.$state"),"\uff09\u65f6\uff0c\u9700\u8981\u5c06\u7c7b\u578b\u6dfb\u52a0\u5230",(0,r.yg)("inlineCode",{parentName:"p"},"PiniaCustomStateProperties"),"\u3002\u4e0e ",(0,r.yg)("inlineCode",{parentName:"p"},"PiniaCustomProperties"),"\u4e0d\u540c\uff0c\u5b83\u53ea\u63a5\u6536",(0,r.yg)("inlineCode",{parentName:"p"},"State"),"\u6cdb\u578b\uff1a(\u6ce8\u610f\u4e24\u4e2a\u957f\u540d\u79f0\u662f\u4e0d\u4e00\u6837\u7684\ud83d\udc46)"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import 'pinia'\n \n declare module 'pinia' {\n   export interface PiniaCustomStateProperties<S> {\n     hello: string\n   }\n }\n")),(0,r.yg)("p",null,"\u2b50\u2b50type \u65b0\u7684creation options"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import 'pinia'\n \n declare module 'pinia' {\n   export interface DefineStoreOptionsBase<S, Store> {\n     // allow defining a number of ms for any of the actions\n     debounce?: Partial<Record<keyof StoreActions<Store>, number>>\n   }\n }\n")),(0,r.yg)("h5",{id:"\u5728\u7ec4\u4ef6\u4e4b\u5916\u4f7f\u7528pinia"},(0,r.yg)("b",null,"\u5728\u7ec4\u4ef6\u4e4b\u5916\u4f7f\u7528pinia")),(0,r.yg)("p",null,"pinia\u7684\u4efb\u4f55\u4ed3\u5e93\u90fd\u4f9d\u8d56\u4e8e\u6839\u4ed3\u5e93\u6765\u7ef4\u6301\u5728\u4efb\u4f55\u8c03\u7528\u4e2d\u7684\u4e00\u81f4\u6027\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff08\u7ec4\u4ef6\u8bed\u6cd5\u4e0b\uff09\uff0c\u7531\u4e8epinia\u5b9e\u4f8b\u81ea\u52a8\u6ce8\u5165\u5230\u4e86app\uff0c",(0,r.yg)("inlineCode",{parentName:"p"},"useStore()"),"\u5c31\u76f4\u63a5\u89e3\u51b3\u95ee\u9898\u4e86 \uff0c\u4e0d\u9700\u8981\u989d\u5916\u5de5\u4f5c\u3002\u4f46\u662f\uff0c\u5f53\u5728\u7ec4\u4ef6\u5916\u5de5\u4f5c\u7684\u65f6\u5019pinia\u4e0d\u4f1a\u81ea\u52a8\u6ce8\u5165\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u624b\u52a8\u628apinia\u5b9e\u4f8b\u4f20\u7ed9",(0,r.yg)("inlineCode",{parentName:"p"},"useStore()")),(0,r.yg)("p",null,"\u6839\u636e\u6240\u7f16\u5199\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u7c7b\u578b\u4ee5\u4e0d\u540c\u65b9\u5f0f\u89e3\u51b3\u6b64\u95ee\u9898\u3002"),(0,r.yg)("p",null,"\u2b50\u5355\u9875\u5e94\u7528"),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"If you are not doing any SSR (Server Side Rendering), any call of ",(0,r.yg)("inlineCode",{parentName:"p"},"useStore()")," after installing the pinia plugin with ",(0,r.yg)("inlineCode",{parentName:"p"},"app.use(pinia)")," will work:"),(0,r.yg)("pre",{parentName:"blockquote"},(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { useUserStore } from '@/stores/user'\n import { createApp } from 'vue'\n import App from './App.vue'\n"))),(0,r.yg)("p",null," // \u274c  fails because it's called before the pinia is created\nconst userStore = useUserStore()"),(0,r.yg)("p",null," const pinia = createPinia()\nconst app = createApp(App)\napp.use(pinia)"),(0,r.yg)("p",null," // \u2705 works because the pinia instance is now active\nconst userStore = useUserStore()"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"\n\u6700\u7b80\u5355\u7684\u786e\u4fdd\u59cb\u7ec8\u5e94\u7528\u8fd9\u79cd\u529f\u80fd\u65b9\u6cd5\u662f\u901a\u8fc7\u5c06\u5b83\u4eec\u653e\u7f6e\u5728\u5b89\u88c5 pinia \u540e\u59cb\u7ec8\u8fd0\u884c\u7684\u51fd\u6570\u4e2d\u6765<em>\u5ef6\u8fdf</em>\u8c03\u7528`useStore()`\u3002\n\n\u770b\u4e00\u4e2avue router\u7684\u4f8b\u5b50\uff1a\n\n```js\nimport { createRouter } from 'vue-router'\n const router = createRouter({\n   // ...\n })\n \n // \u274c Depending on the order of imports this will fail\n const store = useStore()\n \n router.beforeEach((to, from, next) => {\n   // we wanted to use the store here\n   if (store.isLoggedIn) next()\n   else next('/login')\n })\n \n router.beforeEach((to) => {\n   // \u2705 This will work because the router starts its navigation after\n   // the router is installed and pinia will be installed too\n   const store = useStore()\n \n   if (to.meta.requiresAuth && !store.isLoggedIn) return '/login'\n })\n")),(0,r.yg)("p",null,"\u2b50SSR\u60c5\u51b5"),(0,r.yg)("p",null,"\u8be6\u89c1SSR\u90e8\u5206\u3002\u4e00\u53e5\u8bdd\u5c31\u662f\u5fc5\u987b\u5c06",(0,r.yg)("inlineCode",{parentName:"p"},"pinia"),"\u5b9e\u4f8b\u4f20\u9012\u7ed9",(0,r.yg)("inlineCode",{parentName:"p"},"useStore()"),". \u8fd9\u53ef\u4ee5\u9632\u6b62 pinia \u5728\u4e0d\u540c\u7684",(0,r.yg)("b",null,"\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b"),"\u4e4b\u95f4\u5171\u4eab\u5168\u5c40\u72b6\u6001\u3002"),(0,r.yg)("h4",{id:"ssr"},(0,r.yg)("b",null,"SSR")),(0,r.yg)("h5",{id:"vuevite"},(0,r.yg)("b",null,"Vue&Vite")),(0,r.yg)("p",null,"\u9996\u5148\uff0c\u53ea\u8981\u80fd\u5728setup()\u51fd\u6570\u7684\u9876\u90e8\u8c03\u7528useStore(),\u90a3\u4e48\u5bf9\u4e8eSSR\uff0cpinia\u5c31\u662f\u5f00\u7bb1\u5373\u7528\u7684"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export default defineComponent({\n   setup() {\n     // this works because pinia knows what application is running inside of\n     // setup()\n     const main = useMainStore()\n     return { main }\n   },\n })\n")),(0,r.yg)("p",null,"\u4e8e\u662f\u8fd8\u6709\u5728setup()\u4ee5\u5916\u4f7f\u7528\u7684\u60c5\u51b5\uff0c\u8fd9\u65f6\u5019\u4f60\u9700\u8981\u628apinia\u5b9e\u4f8b\uff08\u8fd9\u4e2a\u5b9e\u4f8b\u8fd8\u4f1a\u88ab\u4f20\u7ed9app\uff09\u4f20\u7ed9useStore\uff08\uff09\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"const pinia = createPinia()\n const app = createApp(App)\n \n app.use(router)\n app.use(pinia)\n \n router.beforeEach((to) => {\n   // \u2705 This will work make sure the correct store is used for the\n   // current running app\n   const main = useMainStore(pinia)\n \n   if (to.meta.requiresAuth && !main.isLoggedIn) return '/login'\n })\n")),(0,r.yg)("p",null,"Pinia\u4e00\u822c\u81ea\u52a8\u5730\u628a",(0,r.yg)("inlineCode",{parentName:"p"},"$pinia"),"\u6dfb\u52a0\u5230\u4e86\u4f60\u7684app\u91cc\uff0c\u8fd9\u4f7f\u5f97\u4f60\u53ef\u4ee5\u5728preFetch\u4e4b\u7c7b\u7684\u51fd\u6570\u91cc\u4f7f\u7528\u5b83"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"export default {\n   serverPrefetch() {\n     const store = useStore(this.$pinia)\n   },\n }\n")),(0,r.yg)("p",null,"\u2b50State hydration"),(0,r.yg)("p",null,"\u8981hydrate\u521d\u59cb\u72b6\u6001\uff0c\u4f7f\u7528\u8005\u9700\u8981\u786e\u4fdd rootState \u5305\u542b\u5728 HTML \u4e2d\u7684\u67d0\u5904\uff0c\u4ee5\u4fbf Pinia \u7a0d\u540e\u83b7\u53d6\u5b83\u3002\u6839\u636e\u4f60\u7528\u4e8e SSR \u7684\u5185\u5bb9\uff0c",(0,r.yg)("b",null,"\u51fa\u4e8e\u5b89\u5168\u539f\u56e0\uff0c\u5e94\u8be5\u907f\u514dstate"),"\u3002\u5b98\u65b9\u63a8\u8350\u4f7f\u7528Nuxt.js \u4f7f\u7528\u7684@nuxt/devalue"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import devalue from '@nuxt/devalue'\n import { createPinia } from 'pinia'\n // retrieve the rootState server side\n const pinia = createPinia()\n const app = createApp(App)\n app.use(router)\n app.use(pinia)\n \n // after rendering the page, the root state is built and can be read directly\n // on pinia.state.value.\n \n // serialize, escape (VERY important if the content of the state can be changed\n // by the user, which is almost always the case), and place it somewhere on\n // the page, for example, as a global variable.\n devalue(pinia.state.value)\n")),(0,r.yg)("p",null,"\u540c\u6837\u53d6\u51b3\u4e8e\u4f60\u7684SSR\u7528\u7684\u662f\u5565\uff0c\u4f60\u4f1a\u8bbe\u7f6e\u4e00\u4e2a\u4f1a\u5728HTML\u91cc\u88ab",(0,r.yg)("inlineCode",{parentName:"p"},"serialized"),"\u7684\u521d\u59cb\u72b6\u6001\u53d8\u91cf"),(0,r.yg)("em",null,"\u8fd8\u8981\u9632\u6b62XSS\u653b\u51fb\uff0c\u8fd9\u4e2a\u6211\u4e0d\u61c2\u8036\uff0c\u8c01\u6765\u8865\u4e00\u53e5"),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"For example, with ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/frandiox/vite-ssr"},"vite-ssr")," you can use the ",(0,r.yg)("inlineCode",{parentName:"p"},"transformState"),(0,r.yg)("a",{parentName:"p",href:"https://github.com/frandiox/vite-ssr#state-serialization"}," option")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"@nuxt/devalue"),":"),(0,r.yg)("pre",{parentName:"blockquote"},(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import devalue from '@nuxt/devalue'\n"))),(0,r.yg)("p",null," export default viteSSR(\nApp,\n{\nroutes,\ntransformState(state) {\nreturn import.meta.env.SSR ? devalue(state) : state\n},\n},\n({ initialState }) => {\n// ...\nif (import.meta.env.SSR) {\n// this will be stringified and set to window.",(0,r.yg)("strong",{parentName:"p"},"INITIAL_STATE"),"\ninitialState.pinia = pinia.state.value\n} else {\n// on the client side, we restore the state\npinia.state.value = initialState.pinia\n}\n}\n)"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"\n\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u91c7\u53d6@nuxt/devalue\u7684\u5176\u4ed6\u66ff\u4ee3\u65b9\u6848\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u8ba1\u5165\u4f60\u80fd\u7528`JSON.stringify()`/`JSON.parse()`\u5b8c\u6210parse\u7684\u5de5\u4f5c\uff0c\u4f60\u7684\u8868\u73b0\u4f1a\u63d0\u5347\u5f88\u591a\n\n##### <b>Nuxt.js</b>\n\n\u5c06 Pinia \u4e0eNuxt.js\u4e00\u8d77\u4f7f\u7528\u66f4\u5bb9\u6613\uff0c\u56e0\u4e3a Nuxt \u5728<em>SSR</em>\u65b9\u9762\u4f1a\u5904\u7406\u5f88\u591a\u4e8b\u60c5\u3002\u4f8b\u5982\uff0c<b>\u4e0d\u9700\u8981\u5173\u5fc3\u5e8f\u5217\u5316\u6216 XSS \u653b\u51fb</b>\u3002Pinia \u652f\u6301 Nuxt Bridge \u548c Nuxt 3\n\n```bash\nyarn add pinia @pinia/nuxt\n # or with npm\n npm install pinia @pinia/nuxt\n")),(0,r.yg)("p",null,"pinia\u63d0\u4f9b\u4e86\u4e00\u4e2a",(0,r.yg)("em",null,"\u6a21\u5757"),"\u6765\u5904\u7406\u4e00\u5207\uff0c\u53ea\u9700\u5c06\u5176\u6dfb\u52a0\u5230\u4f60\u7684",(0,r.yg)("inlineCode",{parentName:"p"},"modules"),"\u6587\u4ef6\u4e2d"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"// nuxt.config.js\n export default defineNuxtConfig({\n   // ... other options\n   modules: [\n     // ...\n     '@pinia/nuxt',\n   ],\n })\n")),(0,r.yg)("p",null,"\u7136\u540e\u5c31\u53ef\u4ee5\u50cf\u6b63\u5e38\u4e00\u6837\u4f7f\u7528store\u4e86"),(0,r.yg)("p",null,"\u540c\u6837\uff0c\u5047\u5982\u8981\u5728setup\u4e4b\u5916\u4f7f\u7528store\uff0c\u4f60\u9700\u8981\u4f20pinia\u5bf9\u8c61\u7ed9useStore()"),(0,r.yg)("p",null,"pinia\u5df2\u7ecf\u628a",(0,r.yg)("inlineCode",{parentName:"p"},"$pinia"),"\u6dfb\u52a0\u5230\u4e86\u4e0a\u4e0b\u6587\u4e2d\uff0c\u53ef\u4ee5\u5728",(0,r.yg)("inlineCode",{parentName:"p"},"asyncData()"),"\u548c",(0,r.yg)("inlineCode",{parentName:"p"},"fetch()"),"\uff1a\u4e2d\u8bbf\u95ee\u5b83"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"import { useStore } from '~/stores/myStore'\n \n export default {\n   asyncData({ $pinia }) {\n     const store = useStore($pinia)\n   },\n }\n")),(0,r.yg)("p",null,"\u2b50\u81ea\u52a8import"),(0,r.yg)("p",null,"\u9ed8\u8ba4\u60c5\u51b5 ",(0,r.yg)("inlineCode",{parentName:"p"},"@pinia/nuxt")," \u66b4\u9732\u4e00\u4e2a\u81ea\u52a8import\uff1a ",(0,r.yg)("inlineCode",{parentName:"p"},"usePinia()"),"\u3002\u8fd9\u4e1c\u897f\u7c7b\u4f3c\u4e8e ",(0,r.yg)("inlineCode",{parentName:"p"},"getActivePinia()"),"\uff0c\u4f46\u662f\u548cNuxt\u5de5\u4f5c\u7684\u66f4\u597d\uff0c\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u6dfb\u52a0auto import\uff0c\u6765\u8ba9\u5f00\u53d1\u66f4\u65b9\u4fbf\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"// nuxt.config.js\n export default defineNuxtConfig({\n   // ... other options\n   modules: [\n     // ...\n     [\n       '@pinia/nuxt',\n       {\n         autoImports: [\n           // automatically imports defineStore\n           'defineStore', // import { defineStore } from 'pinia'\n           // automatically imports defineStore as definePiniaStore\n           ['defineStore', 'definePiniaStore'], // import { defineStore as definePiniaStore } from 'pinia'\n         ],\n       },\n     ],\n   ],\n })\n")),(0,r.yg)("h4",{id:"\u5c0f\u7ed3"},(0,r.yg)("b",null,"\u5c0f\u7ed3")),(0,r.yg)("p",null,"\u603b\u4f53\u800c\u8a00pinia\u5728\u4f7f\u7528\u4e0a\u662f\u5f88\u76f4\u89c2\u7684\uff0c\u7ecf\u8fc7\u4e0a\u9762\u7684\u5feb\u901f\u4e0a\u624b\u5e94\u8be5\u5df2\u7ecf\u80fd\u628a\u8001\u9879\u76ee\u7528pinia\u5b9e\u73b0\u4e86\uff0c\u8fd9\u4e5f\u5c31\u8fbe\u5230\u4e86\u4e0a\u624b\u7684\u76ee\u7684\u3002\u603b\u7ed3\u6765\u770bpinia\uff08\u6211\u770b\u6765\u7684\uff09\u4f18\u52bf\u5927\u81f4\u6709"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"ts\u9999"),(0,r.yg)("li",{parentName:"ul"},"\u8bed\u6cd5\u76f4\u89c2\u7b80\u5355\uff08\u4e0d\u5982\u8bf4\u592a\u7b80\u5355\uff09"),(0,r.yg)("li",{parentName:"ul"},"\u63d2\u4ef6\u652f\u6301\u597d")),(0,r.yg)("p",null,"\u8981\u4e86\u89e3\u66f4\u591apinia\u5185\u5bb9\u53ef\u4ee5\u4ece\u8fd9\u51e0\u4e2a\u89d2\u5ea6\u5165\u624b\uff1a\uff08\u4e0d\u9650\u4e8e\uff09"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"\u4e0d\u540c\u7248\u672c\u4e2d\u7684\u4f7f\u7528"),(0,r.yg)("li",{parentName:"ul"},"nuxt.js"),(0,r.yg)("li",{parentName:"ul"},"\u548c\u5176\u4ed6\u4ed3\u5e93\u7684\u5bf9\u6bd4")),(0,r.yg)("p",null,"\u8981\u771f\u6b63\u719f\u7ec3pinia\u6015\u662f\u8fd8\u5f97\u5199\u4e0a\u4e00\u5199\uff0c\u4e0d\u8fc7\u65e2\u7136\u5b9e\u9a8c\u5ba4\u63a8ts\u8fdf\u65e9\u4f1a\u7528\u5230\u7f62"),(0,r.yg)("h4",{id:"\u6587\u6863\u548c\u5f15\u7528"},(0,r.yg)("b",null,"\u6587\u6863\u548c\u5f15\u7528")),(0,r.yg)("p",null,"\u5b98\u65b9\u6587\u6863\uff1a",(0,r.yg)("a",{parentName:"p",href:"https://pinia.vuejs.org/core-concepts/#using-the-store"},"https://pinia.vuejs.org/core-concepts/#using-the-store")))}c.isMDXComponent=!0}}]);