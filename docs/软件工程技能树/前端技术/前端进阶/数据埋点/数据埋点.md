---
title: 数据埋点
slug: 数据埋点
sidebar_position: 4
---


# 数据埋点

Author: 黄新鸿

## 一、概述

埋点技术是指在应用程序中嵌入特定代码，用于<b>监听用户行为并收集上报</b>。这些数据被用于分析和优化产品，帮助产品运营团队更好地理解用户行为，改善产品设计，提高用户体验。通过对用户行为的监测，能够实时获取产品的使用情况，为产品优化提供数据支持。

埋点数据上报后，可以进行事件分析（如分析某个功能用户的点击率、浏览率、页面PV）、漏斗分析（分析用户衰减、过滤）、分布分析（分析用户分布使用情况）、用户分群（对新、老、流失用户进行分群）、数据概览（对经常关注的数据制成概览）。

## 二、埋点类型

埋点根据其实现方式可以分为以下两种类型：

### 1. 代码埋点

代码埋点是在应用代码中直接插入埋点代码，当用户触发某个事件时，埋点代码会将事件数据上报到服务器。

优点：可以精确控制采集的数据和上报频率

缺点：需要开发人员手动修改代码，灵活性差，且容易出现遗漏

例子：

```js
button.addEventListener('click', function() {trackEvent('button_click', {button_name: 'submit'});
});
```

### 2. 无埋点（全埋点）

无埋点是一种自动化的埋点技术，通过自动化工具捕捉用户行为并上报数据。

优点：灵活性较高，且可以快速进行数据采集

缺点：可能会存在一定的数据冗余问题，收集的数据较为粗糙，分析时需要更多的后期清理和处理。

例子：无埋点工具可以通过用户的点击、滚动、页面跳转等行为，自动生成埋点事件并上报。

## 三、埋点设计

需求调研-&gt;明确分析目标-&gt;业务拆解-&gt;埋点设计-&gt;要素设计-&gt;输出需求文档DRD

埋点组成：

- module_id：模块ID
- module_name：模块名称
- content_id：项目ID，如具体的按钮、控件
- content_name：项目名
- event：事件
- args：状态/参数

### 1. 事件定义

首先需要定义清晰的事件类型以及事件的参数。例如，点击按钮、页面浏览、购买行为等。这些事件可以基于用户的核心行为进行定义。

- <b>点击事件（click）</b>
- <b>区域曝光事件（ep）</b>
- <b>页面浏览事件（tp）</b>
- 进入页面（enter）
- 退出页面（back）
- 滑动（slide）

命名采用下划线命名法：<b>模块名称_事件名称_事件类型</b>

如会员页面点击会员升级规则按钮：vip_rule_click

### 2. 数据字段设计

对于每个事件，需要明确其上报的数据字段，如时间戳、用户ID、事件类型、设备信息、位置等。这些字段有助于后续数据的分析和挖掘。

- who（用户）：用户&设备的唯一标识
- when（时间）：事件发生时间
- where（场景）：用户访问的地址、IP信息
- how（方式）：访问的设备、操作系统、版本号、网络类型、场景值
- what（行为）：具体的行为属性

<b>公参</b> 

![](/assets/NyKlbpkwmojhpmxshZQcrJIrnDb.png)

<b>自定义参数</b>

![](/assets/KMLibc6bZozCVjxpDJWcThGTnCe.png)

### 3. 数据上报

数据上报的方式需要考虑如何高效、可靠地传输数据。常见的方式包括 HTTP 请求（如 POST、GET），WebSocket，或者专门的消息队列等。

触发时机

- 前端触发上报
- 前端获取后端结果后上报
- 后端触发上报
- 后端获取前端属性上报

### 4. 数据存储

埋点数据存储需要选择合适的数据库或大数据存储方案。例如，使用实时数据处理框架（如 Kafka、Flink）处理大量事件数据，存储在 HDFS、ClickHouse、Elasticsearch 等数据存储系统中。

### 5. 数据分析与展示

数据分析与展示层主要通过数据可视化工具（如 Tableau、Grafana）或自定义开发的 BI 平台，对收集到的埋点数据进行汇总分析，展示出用户行为的趋势、活跃度、转化率等关键指标。

## 四、埋点实现

### 1.生成唯一会话ID

```js
router.afterEach((to, from, next) => {  
 const uuid = to.query.logId || Utils.uuid();  
 console.log('进入页面，生成会话id');  
 sessionStorage.setItem('capol-log-uuid', uuid);  
});
```

### 2.封装埋点方法

```js
class CapolLog {  
 static pointAdd(dynamicInfo, el) {  
   // 添加埋点逻辑  
 }  
 static pointUpdate(id, type, updateData) {  
   // 更新埋点逻辑  
 }  
 static pointUpdateHelper(event, operateResultBool) {  
   // 辅助更新埋点逻辑  
 }  
}  
export default CapolLog;
```

### 3.封装vue指令

```js
Vue.directive('capol-log', {  
 inserted(el, binding) {  
   const handleClick = () => {  
     const idFlag = binding.modifiers.idFlag ? 1 : 0;  
     const data = binding.value;  
     CapolLog.pointAdd(data, el);  
   };  
   el.addEventListener('click', handleClick);  
 }  
});
```

## 五、埋点平台

埋点的实现主要涉及以下几个关键部分：

### 1. 埋点 SDK

埋点 SDK 是实现埋点的核心组件。它通常会提供一组 API 或者配置文件，用来帮助开发者集成埋点功能。SDK 负责捕捉事件并将数据上报到埋点数据服务。

##### 主要功能：

- 事件捕获：捕捉用户的行为事件（如点击、滑动、页面访问等）。
- 数据上报：将捕捉到的事件数据传输到埋点数据服务。
- 配置管理：可以灵活配置上报的频率、字段等信息。

### 2. 埋点数据服务

埋点数据服务负责接收来自 SDK 上报的埋点数据，并对数据进行处理。数据服务可以做以下处理：

- 数据清洗：去除冗余数据、异常数据。
- 数据存储：将数据存入数据库或者其他存储系统中。
- 数据处理：根据需求进行数据分析，计算出相关指标（如日活跃用户、转化率等）。

### 3. 埋点平台

埋点平台是展示和分析埋点数据的系统。它提供了一个界面，让产品运营人员和数据分析师可以方便地查看和分析用户行为数据。平台应具有以下功能：

- 数据查询：支持多维度的数据查询，能够灵活筛选时间、事件类型、用户群体等信息。
- 数据可视化：通过图表、热力图等方式展示用户行为的趋势和特征。
- 报告生成：支持自定义报表生成功能，用于定期输出分析报告。

