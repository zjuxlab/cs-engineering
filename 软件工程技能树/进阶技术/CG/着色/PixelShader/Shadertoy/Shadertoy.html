<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-软件工程技能树/进阶技术/CG/着色/PixelShader/Shadertoy/Shadertoy" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Shadertoy | CS-Engineering</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-test-site.com/cs-engineering/img/small-logo.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-test-site.com/cs-engineering/img/small-logo.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/cs-engineering/软件工程技能树/进阶技术/CG/着色/PixelShader/Shadertoy/Shadertoy"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Shadertoy | CS-Engineering"><meta data-rh="true" name="description" content="Author: 陈儒"><meta data-rh="true" property="og:description" content="Author: 陈儒"><link data-rh="true" rel="icon" href="/cs-engineering/img/small-logo.svg"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/cs-engineering/软件工程技能树/进阶技术/CG/着色/PixelShader/Shadertoy/Shadertoy"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/cs-engineering/软件工程技能树/进阶技术/CG/着色/PixelShader/Shadertoy/Shadertoy" hreflang="zh"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/cs-engineering/软件工程技能树/进阶技术/CG/着色/PixelShader/Shadertoy/Shadertoy" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/cs-engineering/blog/rss.xml" title="CS-Engineering RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cs-engineering/blog/atom.xml" title="CS-Engineering Atom Feed"><link rel="stylesheet" href="/cs-engineering/assets/css/styles.4c83be5a.css">
<link rel="preload" href="/cs-engineering/assets/js/runtime~main.ff1670aa.js" as="script">
<link rel="preload" href="/cs-engineering/assets/js/main.c272b5bd.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cs-engineering/"><div class="navbar__logo"><img src="/cs-engineering/img/small-logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/cs-engineering/img/small-logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">CS-Engineering</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cs-engineering/新人必看CS工程指南介绍/gvpywcwokiqophkzxotckxylnld-gvpywc">知识空间</a><a class="navbar__item navbar__link" href="/cs-engineering/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zjuxlab/cs-engineering" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cs-engineering/新人必看CS工程指南介绍/gvpywcwokiqophkzxotckxylnld-gvpywc">新人必看：CS工程指南介绍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item software_engineering_sidebar"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/cs-engineering/软件工程技能树/软件工程技能树">软件工程技能树</a><button aria-label="打开/收起侧边栏菜单「软件工程技能树」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed basic_sidebar"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/基础入门/基础入门">基础入门</a><button aria-label="打开/收起侧边栏菜单「基础入门」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed frontend_sidebar"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/前端技术/前端技术">前端技术</a><button aria-label="打开/收起侧边栏菜单「前端技术」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed backend_sidebar"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/后端技术/后端技术">后端技术</a><button aria-label="打开/收起侧边栏菜单「后端技术」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed devops_sidebar"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/运营维护/运营维护">运营维护</a><button aria-label="打开/收起侧边栏菜单「运营维护」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed tools_sidebar"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/开发工具/开发工具">开发工具</a><button aria-label="打开/收起侧边栏菜单「开发工具」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item advanced_sidebar"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/进阶技术">进阶技术</a><button aria-label="打开/收起侧边栏菜单「进阶技术」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/WEB3区块链/WEB3：区块链">WEB3：区块链</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/GUI开发Qt/GUI开发：Qt">GUI开发：Qt</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/量子计算/量子计算">量子计算</a><button aria-label="打开/收起侧边栏菜单「量子计算」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/CG/CG">CG</a><button aria-label="打开/收起侧边栏菜单「CG」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/CG/光栅化/光栅化">光栅化</a><button aria-label="打开/收起侧边栏菜单「光栅化」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/CG/着色/着色">着色</a><button aria-label="打开/收起侧边栏菜单「着色」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/CG/着色/PixelShader/Pixel Shader">Pixel Shader</a><button aria-label="打开/收起侧边栏菜单「Pixel Shader」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/CG/着色/PixelShader/Shadertoy/Shadertoy">Shadertoy</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/CG/几何/几何">几何</a><button aria-label="打开/收起侧边栏菜单「几何」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/CG/光追/光追">光追</a><button aria-label="打开/收起侧边栏菜单「光追」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/CG/API/API">API</a><button aria-label="打开/收起侧边栏菜单「API」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/客户端开发/客户端开发">客户端开发</a><button aria-label="打开/收起侧边栏菜单「客户端开发」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cs-engineering/软件工程技能树/进阶技术/大数据/大数据">大数据</a><button aria-label="打开/收起侧边栏菜单「大数据」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/cs-engineering/软件科研技能树/软件科研技能树">软件科研技能树</a><button aria-label="打开/收起侧边栏菜单「软件科研技能树」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/cs-engineering/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/cs-engineering/软件工程技能树/软件工程技能树"><span itemprop="name">软件工程技能树</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/cs-engineering/软件工程技能树/进阶技术/进阶技术"><span itemprop="name">进阶技术</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/cs-engineering/软件工程技能树/进阶技术/CG/CG"><span itemprop="name">CG</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/cs-engineering/软件工程技能树/进阶技术/CG/着色/着色"><span itemprop="name">着色</span></a><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/cs-engineering/软件工程技能树/进阶技术/CG/着色/PixelShader/Pixel Shader"><span itemprop="name">Pixel Shader</span></a><meta itemprop="position" content="5"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Shadertoy</span><meta itemprop="position" content="6"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Shadertoy</h1><p>Author: 陈儒</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前置知识">前置知识<a href="#前置知识" class="hash-link" aria-label="前置知识的直接链接" title="前置知识的直接链接">​</a></h2><p>你不需要任何的图形学知识，只需要一点线性代数就行了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="简介的直接链接" title="简介的直接链接">​</a></h2><p>接触图形学的同学肯定会碰到shader这一概念，shader（着色器）是一段程序，用于渲染，按照作用对象的不同，分为vertex shader（顶点着色器）和pixel shader（像素着色器）。</p><p>今天介绍的shadertoy就是基于pixel shader搭建的一个开源网站，用户们可以在上面分享和实践各种实时渲染动画。Shadertoy是一个非常好的学习图形学的工具，它基本上不依赖建模，模型基本由数学公式及距离场产生。</p><blockquote><p>相关链接：<a href="https://www.shadertoy.com/" target="_blank" rel="noopener noreferrer">https://www.shadertoy.com/</a></p></blockquote><blockquote><p>shadertoy是一个基于 pixel shaders的在线玩具
对于pixel shaders，不同于传统意义上的shader,传统意义上的shader是根据GPU渲染管线，从cpu把图元传递到顶点着色，在通过varing传递给片元，从而处理光照的。所以顶点着色器是每个顶点运行一次，而片元着色器是每个片元(像素）运行一次。而pixel shaders中你可以理解成只是相当于在opengl中只对片元着色(fragment)进行编程，你可以想象成是一个canvas画布。</p></blockquote><p>正如上面这段话所言，shadertoy的mainImage函数就是它的最终输出，它的输入是一个二维向量fragCoord，表示当前定位的是图片的(x,y)像素点，输出则是一个四维向量fragColor，表示这个像素的rgba值，说白了，你就是写一个函数来告诉计算机每个像素点该生成什么颜色。</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void mainImage(out vec4 fragColor,in vec2 fragCoord){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fragColor=vec4(vec3(0.),1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上述代码会生成一片黑色</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="inigo-quilez">Inigo Quilez<a href="#inigo-quilez" class="hash-link" aria-label="Inigo Quilez的直接链接" title="Inigo Quilez的直接链接">​</a></h2><p>提到shadertoy那就不得不提到非常牛逼的大神IQ，他是一个西班牙人，也是shadertoy的合作创始人。在他的博客里有非常多的sdf函数、近似算法、滤波操作等等，接下来我们要用到的很多函数就来自他的博客（链接：<a href="https://iquilezles.org/%EF%BC%8Chttps://www.youtube.com/@InigoQuilez%EF%BC%89" target="_blank" rel="noopener noreferrer">https://iquilezles.org/，https://www.youtube.com/@InigoQuilez）</a></p><p>他的许多作品都是不依赖建模，而是靠数学函数以及交并补运算来获得，最神奇的就是这个用数学函数做的Selfie Girl，我在参加稀土掘金的shadertoy赛道比赛时就是参考的这个视频（链接：<a href="https://www.youtube.com/watch?v=8--5LwHRhjk%EF%BC%8Chttps://www.shadertoy.com/view/WsSBzh%EF%BC%89" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=8--5LwHRhjk，https://www.shadertoy.com/view/WsSBzh）</a></p><p><img loading="lazy" src="/cs-engineering/assets/images/SZjdbpmzkoQUY0x2zsdc8X8OnLe-f1372b22e779b0dc759a4eebe071ae2a.png" width="2506" height="1145" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="环境配置">环境配置<a href="#环境配置" class="hash-link" aria-label="环境配置的直接链接" title="环境配置的直接链接">​</a></h2><p><img loading="lazy" src="/cs-engineering/assets/images/AemRbN9JmontnHxcwUGc1DGDnBf-e321c9941ee68dc7a537a18b781446a1.png" width="2553" height="1358" class="img_ev3q"></p><p>Shadertoy是提供了在线编辑和在线预览功能的，所以理论上来说不需要配环境，但是离线的性能更好一点，所以还是推荐在VSCODE里搜索插件shadertoy即可</p><p><img loading="lazy" src="/cs-engineering/assets/images/Ca4ObMCPEo4yvYxIY6scCIwAnkI-3f97d14ecef8716414ce56ff8cee6853.png" width="302" height="173" class="img_ev3q"></p><p>新建一个.glsl文件，写入main函数，右键选择Show GLSL Preview即可在右部窗口看见我们的预览。</p><p><img loading="lazy" src="/cs-engineering/assets/images/VJ3hbh7OMoMftHx9iyEc65bRnih-7c66c82101747f935aba8de86e4f4538.png" width="302" height="402" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2d基础操作">2d基础操作<a href="#2d基础操作" class="hash-link" aria-label="2d基础操作的直接链接" title="2d基础操作的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="坐标转换">坐标转换<a href="#坐标转换" class="hash-link" aria-label="坐标转换的直接链接" title="坐标转换的直接链接">​</a></h3><p>通常情况下，我们如果直接使用像素坐标，很难直观地获取我们想要的数据，因此我们需要对像素坐标fragCoord进行处理，shadertoy内置了变量iResolution，它是一个二维向量，用于表示屏幕的宽与高，因此，以2:3的canvas为例，我们进行如下计算，便可让输出坐标中，(1,1.5)表示右上角，(-1,-1.5)表示左下角。</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vec2 fixUV(in vec2 c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (2.*c-iResolution.xy)/min(iResolution.x,iResolution.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/cs-engineering/assets/images/X5V1bTJ97oqElNxaEB9cXuklnBd-f6148a8ba127a8add32914c6682170d7.png" width="876" height="1369" class="img_ev3q"></p><p>（上述只是参考示意图，并不是真正效果）</p><p>所以，我们可以使用一些初等基本函数来帮助我们绘制简单的图形</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vec2 fixUV(in vec2 c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (2.*c-iResolution.xy)/min(iResolution.x,iResolution.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void mainImage(out vec4 fragColor,in vec2 fragCoord){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec2 uv=fixUV(fragCoord);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fragColor=vec4(vec3(uv,1),1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/cs-engineering/assets/images/ACMhbhrd2oTHBbxpZTFcAdCbn7e-5ba54c056e9ce51a23c0587f6998f8e2.png" width="1150" height="1396" class="img_ev3q"></p><p>思考一下为什么会长这样</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vec2 fixUV(in vec2 c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (2.*c-iResolution.xy)/min(iResolution.x,iResolution.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void mainImage(out vec4 fragColor,in vec2 fragCoord){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec2 uv=fixUV(fragCoord);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float c=0.;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(uv.x*uv.x+uv.y*uv.y&lt;1.){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c=1.;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fragColor=vec4(vec3(c),1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/cs-engineering/assets/images/HIw3br8LVoauIoxxSQHchsFFnze-2352738156f2a7c44077c8a810956011.png" width="1142" height="1357" class="img_ev3q"></p><p>上述为圆<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x^2+y^2=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">1</span></span></span></span></span>的表示法，如果在圆内，则刷上白色，否则为黑色。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="内置函数运算">内置函数运算<a href="#内置函数运算" class="hash-link" aria-label="内置函数运算的直接链接" title="内置函数运算的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="clampabx">clamp(a,b,x)<a href="#clampabx" class="hash-link" aria-label="clamp(a,b,x)的直接链接" title="clamp(a,b,x)的直接链接">​</a></h4><p>x<!-- -->&lt;<!-- -->a则返回a,x<!-- -->&gt;<!-- -->b则返回b,否则返回x</p><p>用法：可以将x限制在某一范围内</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="smoothstepabx">smoothstep(a,b,x)<a href="#smoothstepabx" class="hash-link" aria-label="smoothstep(a,b,x)的直接链接" title="smoothstep(a,b,x)的直接链接">​</a></h4><p>使用线性插值，如果x<!-- -->&lt;<!-- -->a则返回0，x<!-- -->&gt;<!-- -->b则返回1，否则返回<!-- -->[a,b]<!-- -->上的x三次插值函数，值域为<!-- -->[0,1]</p><p>用法：因为返回的是三次插值函数，所以可以用于消除边缘锯齿</p><p>如上图所示，圆的边缘是存在锯齿的，如果我们这样写</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vec2 fixUV(in vec2 c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (2.*c-iResolution.xy)/min(iResolution.x,iResolution.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void mainImage(out vec4 fragColor,in vec2 fragCoord){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec2 uv=fixUV(fragCoord);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float c=smoothstep(1.,0.97,uv.x*uv.x+uv.y*uv.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fragColor=vec4(vec3(c),1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>就可以让边缘更加光滑，成功消除了锯齿</p><p><img loading="lazy" src="/cs-engineering/assets/images/Xh1gbi7cvopaR1xKAIAcNx2onfg-d5b58b354f8bd69db9e390fba4318e22.png" width="1128" height="1269" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mixfloat-x-float-y-float-a">mix(float x, float y, float a)<a href="#mixfloat-x-float-y-float-a" class="hash-link" aria-label="mix(float x, float y, float a)的直接链接" title="mix(float x, float y, float a)的直接链接">​</a></h4><p>返回线性插值x×(1−a)+y×a</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2d距离函数">2d距离函数<a href="#2d距离函数" class="hash-link" aria-label="2d距离函数的直接链接" title="2d距离函数的直接链接">​</a></h3><p>在shadertoy 3d中，我们是靠距离场来判断当前像素点是否会触碰到物体的，因此我们先来掌握2d图像中的距离函数。</p><p>某物体的距离函数sdf的意思就是当前点距离该物体的最短距离</p><p>以圆为例，</p><p>我们可以将上述代码修改为</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vec2 fixUV(in vec2 c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (2.*c-iResolution.xy)/min(iResolution.x,iResolution.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">float sdCircle(in vec2 x,float r){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return length(x)-r;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void mainImage(out vec4 fragColor,in vec2 fragCoord){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec2 uv=fixUV(fragCoord);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 c=1.+sign(sdCircle(uv,1.))*vec3(1.,1.,1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fragColor=vec4(c,1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中sdCircle就代表我们的圆的距离函数</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3d基础操作">3d基础操作<a href="#3d基础操作" class="hash-link" aria-label="3d基础操作的直接链接" title="3d基础操作的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="透视摄像头">透视摄像头<a href="#透视摄像头" class="hash-link" aria-label="透视摄像头的直接链接" title="透视摄像头的直接链接">​</a></h3><p>大家都知道我们肉眼看物体遵循近大远小的规则，这是与我们人眼构造相关的。透视摄像头就是把我们的屏幕作为一个平面，也就是人眼，将不同方向的光与摄像头中心进行连线，并投影在这个平面上。而采用平行线进行投影的叫做正交摄像头，一般用于UI制作。</p><p>我们的shadertoy 3d也是采用的透视摄像头，下面我们来看一看正交摄像头视角下是怎样确定当前像素点应该显示什么颜色的。</p><p><img loading="lazy" src="/cs-engineering/assets/images/VZb2bqDvDoGChTxdjLgcfgRvnTd-a8cfa0c8733e67ab29572d5577069f4d.png" width="585" height="301" class="img_ev3q"></p><p>如上图所示，我们确定一个点作为相机的中心，然后从这个相机出发，对屏幕上各个像素点进行连线，并延长至物体上，记为View Ray，物体对应的点经过光线漫反射，在ViewRay反方向上的光线颜色，即为该像素点的颜色</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="距离场">距离场<a href="#距离场" class="hash-link" aria-label="距离场的直接链接" title="距离场的直接链接">​</a></h3><p>SDF是Signed-distance-field的简写，译作有向距离场，它是一个记录空间任意一点到模型表面的最小距离的函数。 </p><p>例如球体的距离场函数为</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">float sdfSphere(vec3 p, vec3 o,float r){// p 为任意点，o为球心，r为半径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return length(p-o)-r;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>长方体的距离场函数为</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">float sdBox( vec3 p, vec3 b ){//b为(x,y,z)方向上对应的长度，假设原点为(0,0,0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vec3 q = abs(p) - b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>有了透视摄像机与距离场的概念，我们便可以进行下一步探索：如何知道我的像素点上看到的是哪个图形呢，这就要用到Ray marching技术了</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ray-marching光线步进">Ray marching（光线步进）<a href="#ray-marching光线步进" class="hash-link" aria-label="Ray marching（光线步进）的直接链接" title="Ray marching（光线步进）的直接链接">​</a></h3><p><img loading="lazy" src="/cs-engineering/assets/images/SEGHb0xFQorRmFxzjCYc1dlKndh-47268d0674b9ba619ace87854685162e.png" width="585" height="301" class="img_ev3q"></p><p>如图所示，假设我们已经知道了camera和Image的关系，现在我们假设已知光源打在球体表面所产生的的漫反射光与球体表面位置的关系，那么只要知道摄像机与Image上像素点的连线（我们称之为View Ray）会落在物体的哪个点上就行了，那么我们如何获取这个点呢？。</p><p><img loading="lazy" src="/cs-engineering/assets/images/EW2rbtdAuox1jBxr12hcsCbgn6b-1d1ab77d1c57d5ed90a6d101a7ce0ebd.png" width="1920" height="1080" class="img_ev3q"></p><p>这就要用到我们的光线步进方法了，如上图所示，我们想要在屏幕上获得每一个点的颜色值，比如说图中屏幕上的P点，很直观的想法是，从摄像头出发，与P点连成一条线，并打到这个球面上，获取这条射线的方向向量很容易，记为v，但是这个方向具体走多远才能到达这个球面呢，我们无法直观地计算出来，但是我们可以通过sdf函数轻松地获得屏幕上任意一个点到这个物体的距离最小值。</p><p>于是我们从P点出发，获得了到球心的最短距离为l1，于是以P+l1*v，即P1点作为我们的下一个步进点，继续获取最短距离l2，像这样循环往复，直到与球体的最短距离小于一个精度值，那么把之前的距离加起来，就是P沿着向量v到球面的距离了。</p><p>对于无法到达球面的点，如上图中的Q点，也是一样，只不过射线会随着步进逐步远离球体，直到达到我们的最大迭代距离。</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//PRESICION为最小精度，TMAX为最大迭代距离</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//sdfSphere为球体sdf公式,ro为摄像机原点，rd为View Ray 方向向量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">float Ray_march(in vec3 ro,in vec3 rd){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float t=TMIN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for(int i=0;i&lt;RAYMARCH_TIME&amp;&amp;t&lt;TMAX;i++){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 p=ro+t*rd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float d=sdfSphere(p);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(d&lt;PRESICION)break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t+=d;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="camera与坐标系转换">camera与坐标系转换<a href="#camera与坐标系转换" class="hash-link" aria-label="camera与坐标系转换的直接链接" title="camera与坐标系转换的直接链接">​</a></h3><p>我们知道，当摄像机的位置发生变化时，如果以摄像机为参考系，那么其他物体的相对坐标就会发生变化，因此我们需要用到线性代数与解析几何学的知识，来对我们的坐标系进行变换。</p><p>从2D到3D转换的视角来看，我们习惯于以屏幕宽度为X轴，高度为Y轴，那么3D空间内的Z轴，就是从屏幕向里看过去。所以当我们固定相机位置ro，并固定相机看向的物体的位置ta，便可以以向量ta-ro作为z&#x27;轴，这是显然的，从物体到摄像机的射线很自然而然地对应了下方的Z轴。之后，我们确定一个旋转角度r，那么取这个<code>sin(r),cos(r),0</code> 与z&#x27;的叉积，作为我们的x&#x27;轴，再取x&#x27;与z&#x27;的叉积，作为y&#x27;轴，即可获得新坐标系的三个方向向量在原坐标系下的坐标值，记为矩阵c=<!-- -->[x,y,z]</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//normalize为向量单位化函数 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mat3 setCamera(vec3 ta,vec3 ro,float cr){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 z=normalize(ta-ro);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 cp=vec3(sin(cr),cos(cr),0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 x=normalize(cross(z,cp));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 y=cross(x,z);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return mat3(x,y,z);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/cs-engineering/assets/images/L7ThbR04hoB7yTxJQpwcNnLInpc-5951b90418192c62a3348440a5f3cadc.png" width="1082" height="1104" class="img_ev3q"></p><p>那么我们要怎样从相机上的坐标<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>O</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><msup><mi>z</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">{O&#x27;,x&#x27;,y&#x27;,z&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span>反推回原来的坐标轴<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">{O,x,y,z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.04398em">z</span></span></span></span></span></span>变为呢，若记前后坐标系向量分别为<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>3</mn></msub><mo separator="true">;</mo><msubsup><mi>e</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo separator="true">,</mo><msubsup><mi>e</mi><mn>2</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo separator="true">,</mo><msubsup><mi>e</mi><mn>3</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">e_1,e_2,e_3;e_1&#x27;,e_2&#x27;,e_3&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.2481em"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em"><span></span></span></span></span></span></span></span></span></span></span></p><p>那么就有</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo fence="true">{</mo><mtable rowspacing="0.25em" columnalign="right" columnspacing=""><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msubsup><mi>e</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><msub><mi>c</mi><mn>11</mn></msub><msub><mi>e</mi><mn>1</mn></msub><mo>+</mo><msub><mi>c</mi><mn>21</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>+</mo><msub><mi>c</mi><mn>31</mn></msub><msub><mi>e</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msubsup><mi>e</mi><mn>2</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><msub><mi>c</mi><mn>12</mn></msub><msub><mi>e</mi><mn>1</mn></msub><mo>+</mo><msub><mi>c</mi><mn>22</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>+</mo><msub><mi>c</mi><mn>32</mn></msub><msub><mi>e</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msubsup><mi>e</mi><mn>3</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><msub><mi>c</mi><mn>13</mn></msub><msub><mi>e</mi><mn>1</mn></msub><mo>+</mo><msub><mi>c</mi><mn>23</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>+</mo><msub><mi>c</mi><mn>33</mn></msub><msub><mi>e</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr></mtable></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation} \left\{ \begin{aligned} e_1&#x27;=c_{11}e_1+c_{21}e_2+c_{31}e_3\\ e_2&#x27;=c_{12}e_1+c_{22}e_2+c_{32}e_3\\ e_3&#x27;=c_{13}e_1+c_{23}e_2+c_{33}e_3\\ \end{aligned} \right. \end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5em;vertical-align:-2em"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em"><span style="top:-4.5em"><span class="pstrut" style="height:4.5em"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35em"><span style="top:-2.2em"><span class="pstrut" style="height:3.15em"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-2.192em"><span class="pstrut" style="height:3.15em"></span><span style="height:0.316em;width:0.8889em"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="0.316em" style="width:0.8889em" viewBox="0 0 888.89 316" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z"></path></svg></span></span><span style="top:-3.15em"><span class="pstrut" style="height:3.15em"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.292em"><span class="pstrut" style="height:3.15em"></span><span style="height:0.316em;width:0.8889em"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="0.316em" style="width:0.8889em" viewBox="0 0 888.89 316" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z"></path></svg></span></span><span style="top:-4.6em"><span class="pstrut" style="height:3.15em"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.85em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em"><span style="top:-4.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em"><span style="top:-4.5em"><span class="pstrut" style="height:4.5em"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em"><span></span></span></span></span></span></span></span></span></div><p>即：</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>e</mi><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><msubsup><mi>e</mi><mn>2</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><msubsup><mi>e</mi><mn>3</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>e</mi><mn>1</mn></msub><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><msub><mi>e</mi><mn>2</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>e</mi><mn>3</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>∗</mo><mi>C</mi></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation} \begin{bmatrix} e_{1}&#x27; &amp; e_{2}&#x27;&amp; e_{3}&#x27; \end{bmatrix} = \begin{bmatrix} e_{1} &amp; e_{2} &amp;e_{3} \end{bmatrix}*C \end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.21em;vertical-align:-0.355em"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.855em"><span style="top:-3.005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em"><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em"><span></span></span></span></span></span></span><span class="mord"> </span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em"><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"> </span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em"><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"> </span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em"><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"> </span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em"><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"> </span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em"><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.355em"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.855em"><span style="top:-2.855em"><span class="pstrut" style="height:2.85em"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.355em"><span></span></span></span></span></span></span></span></span></div><p>其中矩阵</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>C</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mn>13</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mn>23</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mn>31</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mn>32</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mn>33</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation} C= \begin{bmatrix} c_{11} &amp; c_{12} &amp; c_{13} \\ c_{21} &amp; c_{22} &amp; c_{23} \\ c_{31} &amp; c_{32} &amp; c_{33} \\ \end{bmatrix} \end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:4.05em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-2.25em"><span class="pstrut" style="height:3.155em"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-3.397em"><span class="pstrut" style="height:3.155em"></span><span style="height:0.016em;width:0.6667em"><svg xmlns="http://www.w3.org/2000/svg" width="0.6667em" height="0.016em" style="width:0.6667em" viewBox="0 0 666.67 16" preserveAspectRatio="xMinYMin"><path d="M319 0 H403 V16 H319z M319 0 H403 V16 H319z"></path></svg></span></span><span style="top:-4.05em"><span class="pstrut" style="height:3.155em"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-2.25em"><span class="pstrut" style="height:3.155em"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-3.397em"><span class="pstrut" style="height:3.155em"></span><span style="height:0.016em;width:0.6667em"><svg xmlns="http://www.w3.org/2000/svg" width="0.6667em" height="0.016em" style="width:0.6667em" viewBox="0 0 666.67 16" preserveAspectRatio="xMinYMin"><path d="M263 0 H347 V16 H263z M263 0 H347 V16 H263z"></path></svg></span></span><span style="top:-4.05em"><span class="pstrut" style="height:3.155em"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:4.05em"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span></span></div><p>剩下的就是线性代数的知识了，不讲了qwq，总之，对应的原坐标xyz可以表示为</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo fence="true">{</mo><mtable rowspacing="0.25em" columnalign="right" columnspacing=""><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>x</mi><mo>=</mo><msub><mi>c</mi><mn>11</mn></msub><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>+</mo><msub><mi>c</mi><mn>12</mn></msub><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>+</mo><msub><mi>c</mi><mn>13</mn></msub><msup><mi>z</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>y</mi><mo>=</mo><msub><mi>c</mi><mn>21</mn></msub><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>+</mo><msub><mi>c</mi><mn>22</mn></msub><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>+</mo><msub><mi>c</mi><mn>23</mn></msub><msup><mi>z</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>z</mi><mo>=</mo><msub><mi>c</mi><mn>31</mn></msub><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>+</mo><msub><mi>c</mi><mn>32</mn></msub><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>+</mo><msub><mi>c</mi><mn>33</mn></msub><msup><mi>z</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mstyle></mtd></mtr></mtable></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation} \left\{ \begin{aligned} x=c_{11}x&#x27;+c_{12}y&#x27;+c_{13}z&#x27;\\ y=c_{21}x&#x27;+c_{22}y&#x27;+c_{23}z&#x27;\\ z=c_{31}x&#x27;+c_{32}y&#x27;+c_{33}z&#x27;\\ \end{aligned} \right. \end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5em;vertical-align:-2em"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em"><span style="top:-4.5em"><span class="pstrut" style="height:4.5em"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35em"><span style="top:-2.2em"><span class="pstrut" style="height:3.15em"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-2.192em"><span class="pstrut" style="height:3.15em"></span><span style="height:0.316em;width:0.8889em"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="0.316em" style="width:0.8889em" viewBox="0 0 888.89 316" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z"></path></svg></span></span><span style="top:-3.15em"><span class="pstrut" style="height:3.15em"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.292em"><span class="pstrut" style="height:3.15em"></span><span style="height:0.316em;width:0.8889em"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="0.316em" style="width:0.8889em" viewBox="0 0 888.89 316" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z"></path></svg></span></span><span style="top:-4.6em"><span class="pstrut" style="height:3.15em"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.85em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em"><span style="top:-4.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em"><span style="top:-4.5em"><span class="pstrut" style="height:4.5em"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em"><span></span></span></span></span></span></span></span></span></div><p>于是我们可以将设置camera的函数写为</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//ta即target，照相机看向哪个位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//ro为照相机位置，cr为屏幕旋转角</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//返回值为cam矩阵</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mat3 setCamera(vec3 ta,vec3 ro,float cr){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 z=normalize(ta-ro);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 cp=vec3(sin(cr),cos(cr),0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 x=normalize(cross(z,cp));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 y=cross(x,z);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return mat3(x,y,z);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>调用：</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mat3 cam=setCamera(ta,ro,0.);//旋转角为0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec3 rd=normalize(cam*vec3(uv,1.));//1为z轴坐标,rd即为相机与屏幕点uv连成的向量</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="光照">光照<a href="#光照" class="hash-link" aria-label="光照的直接链接" title="光照的直接链接">​</a></h3><p>我们在ray marching中已经知道了view ray的距离t，因此对应的球体上的p点就是相机坐标ro+t*rd。假设我们有一个点光源light，并且给出了位置，那么很自然地可以得到light到p点的光线向量(light-p)。根据Lambert&#x27;s Cosine Law(朗博余弦定理，<a href="https://en.wikipedia.org/wiki/Lambert%27s_cosine_law)%EF%BC%8C%E5%85%89%E6%BA%90%E5%9C%A8%E6%9F%90%E4%B8%80%E7%82%B9%E7%9A%84%E6%BC%AB%E5%8F%8D%E5%B0%84%E5%85%89%E5%BC%BA%E4%B8%8E%E8%AF%A5%E7%82%B9%E6%B3%95%E7%BA%BF%E5%92%8C%E5%85%89%E7%BA%BF%E5%A4%B9%E8%A7%92%E7%9A%84%E4%BD%99%E5%BC%A6%E5%80%BC%E6%88%90%E6%AD%A3%E6%AF%94%E3%80%82" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Lambert%27s_cosine_law)，光源在某一点的漫反射光强与该点法线和光线夹角的余弦值成正比。</a></p><blockquote><p>一个面元的辐亮度或光亮度在其表面上半球的所有方向相等时，则有 I(θ)=I(n)cosθ。式中，I(θ)和I(n)分别表示面元在 θ 角(与表面法线夹角)方向及其法线方向的辐射强度或光强度。</p></blockquote><p>有关漫反射的内容可以看一下GAMES101里Lecture7的末尾部分（链接：<a href="https://www.bilibili.com/video/BV1X7411F744%EF%BC%89%EF%BC%8C%E8%BF%99%E9%87%8C%E5%B0%B1%E4%B8%8D%E7%BB%86%E8%AE%B2%E4%BA%86%E3%80%82" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1X7411F744），这里就不细讲了。</a></p><p>所以我们只需要获得这个点的法线值即可。对于可以求出解析式的方程，求个导就行了，但是有很多函数并没有明确的解析式，解析法并不可行，于是我们可以利用导数的定义，取一个小量，用近似的方法来获得。</p><p>这里iq给出了一个函数，只需要把里面的f换成我们的sdf函数就能计算出这个点的法线向量值</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vec3 calcNormal( in vec3 p ) // for function f(p)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const float eps = 0.0001; // or some other value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const vec2 h = vec2(eps,0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return normalize( vec3(f(p+h.xyy) - f(p-h.xyy),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           f(p+h.yxy) - f(p-h.yxy),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           f(p+h.yyx) - f(p-h.yyx) ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>令n=calcNormal(p),于是我们只需要计算出n与(light-p)的点积，即可表示这个点的颜色。</p><p><img loading="lazy" src="/cs-engineering/assets/images/Hj6ZbnvPYoSeK9x11WjceX7GnVb-8317cbb259498364275f89d8eaf594b0.png" width="1105" height="1357" class="img_ev3q"></p><p>有点像弦月</p><p>但是这样显然不太对，没有光的地方我们一点都看不见了，现实生活中是存在环境的漫反射光的，因此我们只需要给每一点加上一个环境光，也就是rgb最小值。</p><p>最后呢我们想要让这个阴影柔和一些，于是将最后的渲染值开根号即可</p><p>附上完整代码：</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#define TMIN 0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define TMAX 20.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define RAYMARCH_TIME 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define PRESICION .001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec2 fixUV(in vec2 c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (2.*c-iResolution.xy)/min(iResolution.x,iResolution.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">float sdfSphere(in vec3 p){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return length(p)-1.5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec3 calcNormal( in vec3 p ){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const float h = 0.0001; // replace by an appropriate value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const vec2 k = vec2(1,-1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return normalize( k.xyy*sdfSphere( p + k.xyy*h ) + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      k.yyx*sdfSphere( p + k.yyx*h ) + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      k.yxy*sdfSphere( p + k.yxy*h ) + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      k.xxx*sdfSphere( p + k.xxx*h ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">float Ray_march(in vec3 ro,in vec3 rd){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float t=TMIN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for(int i=0;i&lt;RAYMARCH_TIME&amp;&amp;t&lt;TMAX;i++){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 p=ro+t*rd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float d=sdfSphere(p);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(d&lt;PRESICION)break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t+=d;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mat3 setCamera(vec3 ta,vec3 ro,float cr){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 z=normalize(ta-ro);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 cp=vec3(sin(cr),cos(cr),0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 x=normalize(cross(z,cp));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 y=cross(x,z);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return mat3(x,y,z);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec3 render(vec2 uv){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 col=vec3(0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 ro=vec3(2.*cos(iTime),1.5,2.*sin(iTime));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 ta=vec3(0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mat3 cam=setCamera(ta,ro,0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 rd=normalize(cam*vec3(uv,1.));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float t=Ray_march(ro,rd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(t&lt;TMAX){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 p=ro+t*rd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 n=calcNormal(p);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 light=vec3(2.,.5,2.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float dif=clamp(dot(normalize(light-p),n),0.,1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float amb=0.5+0.5*dot(n,vec3(0.,1.,0.));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        col=amb*vec3(0.23)+dif*vec3(1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return sqrt(col);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void mainImage(out vec4 fragColor,in vec2 fragCoord){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 col=vec3(0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    col=render(fixUV(fragCoord));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fragColor=vec4(col,1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/cs-engineering/assets/images/UeNZbRDdhoqVu0xGIBecCLHYnhf-e345bcc08a5c51ca50a3008bd42d2f49.png" width="1108" height="1344" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="卷积超采样">卷积超采样<a href="#卷积超采样" class="hash-link" aria-label="卷积超采样的直接链接" title="卷积超采样的直接链接">​</a></h3><p>上图中我们可以看到，边界存在着明显的锯齿，有没有什么办法能够改善呢？</p><p>我们可以采用卷积超采样的方法，在<!-- -->[x-1,x+1]<!-- -->×<!-- -->[y-1,y+1]<!-- -->范围内选取16个点的卷积核进行超采样，就可以将该图形的边界锯齿消除掉，产生更平滑的边界。</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#define M 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void mainImage(out vec4 fragColor,in vec2 fragCoord){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 col=vec3(0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for(int m=0;m&lt;M;m++){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for(int n=0;n&lt;M;n++){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vec2 offset=2.*(vec2(float(m),float(n))/float(M)-0.5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vec2 uv=fixUV(fragCoord+offset);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            col+=render(uv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fragColor=vec4(col/16.,1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如上述代码所示，offset为偏移量，我们将得到的render值加起来，再除16即可。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="软阴影">软阴影<a href="#软阴影" class="hash-link" aria-label="软阴影的直接链接" title="软阴影的直接链接">​</a></h3><blockquote><p>链接：<a href="https://iquilezles.org/articles/rmshadows/" target="_blank" rel="noopener noreferrer">https://iquilezles.org/articles/rmshadows/</a></p></blockquote><p>在这篇文章中，iq提到了几种进阶的阴影模式，能够让我们的阴影更加平滑</p><p>在一般情况下，如果我们想要表示阴影，那么就以光线作为viewray，进行一次类似raymarch的操作，如果光线沿着这个方向能够达到物体，那么记为暗处，否则记为亮处。</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">float shadow( in vec3 ro, in vec3 rd, float mint, float maxt )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for( float t=mint; t&lt;maxt; )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float h = map(ro + rd*t);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if( h&lt;0.001 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return 0.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t += h;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 1.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但是这样的阴影边界十分明显，我们需要更平滑的阴影，即：软阴影</p><p><img loading="lazy" src="/cs-engineering/assets/images/IuRub8hP9ovOc7xo3wPcWTXznzb-020414dc90a3f175f2d2e6ec4d73e287.png" width="1158" height="315" class="img_ev3q"></p><p>我们在运行上述代码时，同时使用到了h和t两个值，他们分别表示到物体的最短距离和当前光线步进的长度。我们只需要加上一行，对于距离物体边界非常近的光线，虽然h并不会=0，但是可以取h/t作为softshadow的值，这样对于距离边界比较近的光线，仍然能够有一个较小的值用于表示阴影，而非统一赋值为1</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">float softshadow( in vec3 ro, in vec3 rd, float mint, float maxt, float k )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float res = 1.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for( float t=mint; t&lt;maxt; )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float h = map(ro + rd*t);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if( h&lt;0.001 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return 0.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res = min( res, k*h/t );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t += h;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return res;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外还有一种改进后的soft shadow模式，这里请自行阅读，我们就直接拿来用了</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">float softshadow( in vec3 ro, in vec3 rd, float mint, float maxt, float k )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float res = 1.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float ph = 1e20;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for( float t=mint; t&lt;maxt; )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float h = map(ro + rd*t);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if( h&lt;0.001 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return 0.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float y = h*h/(2.0*ph);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float d = sqrt(h*h-y*y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res = min( res, k*d/max(0.0,t-y) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ph = h;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t += h;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return res;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="多物体map">多物体map<a href="#多物体map" class="hash-link" aria-label="多物体map的直接链接" title="多物体map的直接链接">​</a></h3><p>正常情况下，我们的人眼会有一条视平线，在这条线以下的物体我们会看到它的上表面，在这条线以上的物体我们会看到它的下表面，而我们的地平线也设置为此处，因此，只要viewRay的y值大于0，我们就认为处于地平线上方，反之位于地平线下方</p><p><img loading="lazy" src="/cs-engineering/assets/images/KJ7db25iJoEAu2xcJ3rcrr9onzf-c395ac748310fd6226454d5b6d698516.png" width="1529" height="808" class="img_ev3q"></p><p><img loading="lazy" src="/cs-engineering/assets/images/F03ob3pg7one87xOYhGc2CsZngh-221dc0c2bf75887b141323b8a6bbc822.png" width="1111" height="1343" class="img_ev3q"></p><p>与之前的ray march不同，我们这次想要展现多个物体，因此必须对我们ray march到的物体用tag进行区分，我们使用一个二维数组，(x,y) x表示距离，y用于区分当前探测到的是哪个物体。</p><p>如果viewRay向下，那么我们预设该点为地面，并且将迭代最大距离tmax设为相机高度/cos值，也就是相机高度/viewRay.y。同时，距离我们越远的点颜色越深。</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vec2 Ray_march(in vec3 ro,in vec3 rd){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float t=0.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec2 res=vec2(-1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float tmax=40.;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(rd.y&lt;0.){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float tp=-ro.y/rd.y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tmax=min(tmax,-ro.y/rd.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res=vec2(tp,1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for(int i=0;i&lt;RAYMARCH_TIME&amp;&amp;t&lt;tmax;i++){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 p=ro+t*rd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec2 d=map(p);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(d.x&lt;PRESICION){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            res=vec2(t,d.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t+=d.x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return res;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同时我们将我们的sdf函数由单个物体变为多个物体的map函数，2表示球体，3表示立方体，opU则表示取两个sdf函数的最小值，这个很容易理解，因为我们这两个物体看作一个整体的话，到这个整体的最短距离就是到这两个物体的最短距离的最小值。</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vec2 opU(vec2 a,vec2 b){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return a.x&lt;b.x?a:b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec2 map(in vec3 p){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec2 d=vec2(sdfSphere(p-vec3(0.,1,0.)),2.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return opU(d,vec2(sdfrec(p-vec3(2.,1.,0.),vec3(1.,1.,1.)),3.));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在最后渲染时，我们依据不同的tag给出不同的底色</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if(t.y&gt;0.){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 p=ro+t.x*rd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 n=(t.y&lt;1.1)?vec3(0.,1.,0.):calcNormal(p);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 light=vec3(5.,5.,0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float dif=clamp(dot(normalize(light-p),n),0.,1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p+=PRESICION*n;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float st=soft_shadow(p,normalize(light-p),10.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dif*=st;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float amb=0.5+0.5*dot(n,vec3(0.,1.,0.));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 c=vec3(0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(t.y&gt;1.9&amp;&amp;t.y&lt;2.1){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            c=vec3(1.,0.,0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }else if(t.y&gt;0.9&amp;&amp;t.y&lt;1.1){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            c=vec3(0.1)+vec3(0.1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }else if(t.y&gt;2.9&amp;&amp;t.y&lt;3.1){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            c=vec3(1.,1.,0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        col=amb*c+dif*vec3(.7);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>完整代码</p><div class="language-openglshadinglanguage codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-openglshadinglanguage codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#define TMIN 0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define TMAX 100.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define RAYMARCH_TIME 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define PRESICION .001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec2 fixUV(in vec2 c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (2.*c-iResolution.xy)/min(iResolution.x,iResolution.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">float sdfSphere(in vec3 p){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return length(p)-1.;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">float sdfrec(in vec3 p,vec3 b){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 d=abs(p)-b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return length(max(d,0.))+min(max(d.z,max(d.x,d.y)),0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec2 opU(vec2 a,vec2 b){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return a.x&lt;b.x?a:b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec2 map(in vec3 p){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec2 d=vec2(sdfSphere(p-vec3(0.,1,0.)),2.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return opU(d,vec2(sdfrec(p-vec3(2.,1.,0.),vec3(1.,1.,1.)),3.));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec3 calcNormal( in vec3 p ){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const float h = 0.0001; // replace by an appropriate value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const vec2 k = vec2(1,-1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return normalize( k.xyy*map( p + k.xyy*h ).x+ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      k.yyx*map( p + k.yyx*h ).x + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      k.yxy*map( p + k.yxy*h ).x + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      k.xxx*map( p + k.xxx*h ).x );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec2 Ray_march(in vec3 ro,in vec3 rd){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float t=0.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec2 res=vec2(-1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float tmax=40.;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(rd.y&lt;0.){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float tp=-ro.y/rd.y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tmax=min(tmax,-ro.y/rd.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res=vec2(tp,1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for(int i=0;i&lt;RAYMARCH_TIME&amp;&amp;t&lt;tmax;i++){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 p=ro+t*rd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec2 d=map(p);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(d.x&lt;PRESICION){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            res=vec2(t,d.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t+=d.x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return res;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mat3 setCamera(vec3 ta,vec3 ro,float cr){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 z=normalize(ta-ro);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 cp=vec3(sin(cr),cos(cr),0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 x=normalize(cross(z,cp));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 y=cross(x,z);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return mat3(x,y,z);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">float soft_shadow(in vec3 ro, vec3 rd,float k){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float res = 1.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float ph = 1e20;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float tmin=.1,tmax=10.;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for( float t=tmin; t&lt;tmax; ){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float h = map(ro + rd*t).x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if( h&lt;0.001 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return 0.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float y = h*h/(2.0*ph);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float d = sqrt(h*h-y*y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res = min( res, k*d/max(0.0,t-y) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ph = h;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t += h;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return res;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec3 render(vec2 uv,vec2 px,vec2 py){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 ro=vec3(4.*cos(.3*iTime),2.5,4.*sin(.3*iTime));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 ta=vec3(0.,1,0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mat3 cam=setCamera(ta,ro,0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float fl=1.;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 rd=normalize(cam*vec3(uv,fl));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec2 t=Ray_march(ro,rd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 bg=vec3(.7,.7,.9);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 col=bg-rd.y*vec3(.1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(t.y&gt;0.){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 p=ro+t.x*rd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 n=(t.y&lt;1.1)?vec3(0.,1.,0.):calcNormal(p);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 light=vec3(5.,5.,0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float dif=clamp(dot(normalize(light-p),n),0.,1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p+=PRESICION*n;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float st=soft_shadow(p,normalize(light-p),10.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dif*=st;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float amb=0.5+0.5*dot(n,vec3(0.,1.,0.));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec3 c=vec3(0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(t.y&gt;1.9&amp;&amp;t.y&lt;2.1){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            c=vec3(1.,0.,0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }else if(t.y&gt;0.9&amp;&amp;t.y&lt;1.1){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            c=vec3(0.1)+vec3(0.1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }else if(t.y&gt;2.9&amp;&amp;t.y&lt;3.1){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            c=vec3(1.,1.,0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        col=amb*c+dif*vec3(.7);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return sqrt(col);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define M 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void mainImage(out vec4 fragColor,in vec2 fragCoord){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec3 col=vec3(0.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for(int m=0;m&lt;M;m++){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for(int n=0;n&lt;M;n++){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vec2 offset=2.*(vec2(float(m),float(n))/float(M)-0.5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vec2 uv=fixUV(fragCoord+offset);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vec2 px=fixUV(fragCoord+vec2(1.,0.)+offset);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vec2 py=fixUV(fragCoord+vec2(0.,1.)+offset);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            col+=render(uv,px,py);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fragColor=vec4(col/16.,1.);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="布尔运算合成">布尔运算合成<a href="#布尔运算合成" class="hash-link" aria-label="布尔运算合成的直接链接" title="布尔运算合成的直接链接">​</a></h3><p>对于物体的交运算，即我们需要把两个物体拼合为一个物体时，我们可以使用上面的opU函数，即取两个物体的sdf的最小值。</p><p>对于物体的并运算，即我们取两个物体的交叉部分时，则要取两个物体的sdf的最大值。</p><p>对于物体的减运算，我们只需要将减物体的sdf取反，再取sdf最大值即可。</p><p>有了布尔运算之后，你便可以开始进行创作了。</p><p>我见过最牛逼的就是这个，就是这个作品比赛里把我爆杀了（链接：<a href="https://zhuanlan.zhihu.com/p/514951133%EF%BC%89" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/514951133）</a></p><p>使用的是神经网络，心服口服了呜呜</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/软件工程技能树/进阶技术/CG/着色/PixelShader/Shadertoy/Shadertoy.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/cs-engineering/软件工程技能树/进阶技术/CG/着色/PixelShader/Pixel Shader"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Pixel Shader</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cs-engineering/软件工程技能树/进阶技术/CG/几何/几何"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">几何</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前置知识" class="table-of-contents__link toc-highlight">前置知识</a></li><li><a href="#简介" class="table-of-contents__link toc-highlight">简介</a></li><li><a href="#inigo-quilez" class="table-of-contents__link toc-highlight">Inigo Quilez</a></li><li><a href="#环境配置" class="table-of-contents__link toc-highlight">环境配置</a></li><li><a href="#2d基础操作" class="table-of-contents__link toc-highlight">2d基础操作</a><ul><li><a href="#坐标转换" class="table-of-contents__link toc-highlight">坐标转换</a></li><li><a href="#内置函数运算" class="table-of-contents__link toc-highlight">内置函数运算</a></li><li><a href="#2d距离函数" class="table-of-contents__link toc-highlight">2d距离函数</a></li></ul></li><li><a href="#3d基础操作" class="table-of-contents__link toc-highlight">3d基础操作</a><ul><li><a href="#透视摄像头" class="table-of-contents__link toc-highlight">透视摄像头</a></li><li><a href="#距离场" class="table-of-contents__link toc-highlight">距离场</a></li><li><a href="#ray-marching光线步进" class="table-of-contents__link toc-highlight">Ray marching（光线步进）</a></li><li><a href="#camera与坐标系转换" class="table-of-contents__link toc-highlight">camera与坐标系转换</a></li><li><a href="#光照" class="table-of-contents__link toc-highlight">光照</a></li><li><a href="#卷积超采样" class="table-of-contents__link toc-highlight">卷积超采样</a></li><li><a href="#软阴影" class="table-of-contents__link toc-highlight">软阴影</a></li><li><a href="#多物体map" class="table-of-contents__link toc-highlight">多物体map</a></li><li><a href="#布尔运算合成" class="table-of-contents__link toc-highlight">布尔运算合成</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cs-engineering/docs/intro">Tutoria</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cs-engineering/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/zjuxlab/cs-engineering" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 浙江大学启真交叉学科创新创业实验室, Inc.</div></div></div></footer></div>
<script src="/cs-engineering/assets/js/runtime~main.ff1670aa.js"></script>
<script src="/cs-engineering/assets/js/main.c272b5bd.js"></script>
</body>
</html>